<!DOCTYPE html><html lang="en" class="__variable_4eb141"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/d4834662e8b5d3f9-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="preload" as="image" href="/_next/static/media/gpu-container-header.339b8b2a.webp"/><link rel="stylesheet" href="/_next/static/css/362dd02c7d987ff9.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-9928534fc2156327.js"/><script src="/_next/static/chunks/4bd1b696-3671cad27c05b2f2.js" async=""></script><script src="/_next/static/chunks/215-a9568644c260d23b.js" async=""></script><script src="/_next/static/chunks/main-app-00046220a614ac05.js" async=""></script><script src="/_next/static/chunks/173-ffd0b8113e523dc5.js" async=""></script><script src="/_next/static/chunks/536-d4fee2fe7c6d19de.js" async=""></script><script src="/_next/static/chunks/93-bef0623bae112d3c.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-b32b315fa6392c69.js" async=""></script><script src="/_next/static/chunks/app/layout-d8addcc19b69e0c2.js" async=""></script><meta name="next-size-adjust"/><title>Building nvidia-docker containers with nix</title><meta name="description" content="A practical guide on how to package your cuda dependent application build with nix into a docker container."/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="flex flex-col min-h-screen"><header class="px-4 lg:px-6 h-14 flex items-center"><a class="flex items-center justify-center" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open h-6 w-6"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg><span class="sr-only">Acme Blog</span></a><nav class="ml-auto flex gap-4 sm:gap-6"><a class="text-sm font-medium hover:underline underline-offset-4" href="/">Home</a><a class="text-sm font-medium hover:underline underline-offset-4" href="/contact">Contact</a><a class="text-sm font-medium hover:underline underline-offset-4" href="/posts">Blog</a></nav></header><main class="flex-1"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building nvidia-docker containers with nix","datePublished":"2020-03-09T20:33:10+01:00","dateModified":"2020-03-09T20:33:10+01:00","description":"A practical guide on how to package your cuda dependent application build with nix into a docker container.","image":"https://sebastian-staffa.eu/images/gpu-container-header.webp","url":"https://sebastian-staffa.eu/posts/nvidia-docker-with-nix","author":{"@type":"Person","name":"Sebastian Staffa"}}</script><article class="container max-w-3xl px-4 py-6 lg:py-12 mx-auto"><h1 class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl lg:text-6xl/none mb-4">Building nvidia-docker containers with nix</h1><div class="flex items-center space-x-4 mb-4"><span class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"><span class="flex h-full w-full items-center justify-center rounded-full bg-muted">S</span></span><div><p class="text-sm font-medium">Sebastian Staffa</p><p class="text-sm text-gray-500 flex flex-row align-baseline"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar inline-block w-4 h-4 mr-1"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg>Published on<!-- --> <!-- -->Mar 9, 2020, 8:33 PM</p></div></div><img alt="Photo by Tri Eptaroka Mardiana on Unsplash; The NixOS logo is licensed under the Creative Commons Attribution 4.0 International License" width="1080" height="485" decoding="async" data-nimg="1" class="rounded-lg object-cover w-full mb-8" style="color:transparent" src="/_next/static/media/gpu-container-header.339b8b2a.webp"/><div class="prose max-w-none"><p>How to convert the output of a derivation into a self contained package is one
of the most important questions when developing productive Software with nix,
even for prototype applications. If the system you need to deploy to is not
under your control, nix is probably not installed and will not be in the
immediate future.</p>
<p>To avoid having to beg an admin I don&#x27;t even know personally to install nix on
some remote system I have no root access to, I usually just
<a href="https://nixos.org/nixpkgs/manual/#sec-pkgs-dockerTools">build a docker container</a>.
Docker is, as of today, a tool most sys admins know and trust, and if it isn&#x27;t
installed already it shouldn&#x27;t be a problem to convince them to do so. At least
if you want to deploy server applications that is, but you can always use
<a href="https://nixos.org/nixpkgs/manual/#sec-pkgs-appimageTools">AppImages</a> as a
replacement if you need to deploy user applications.</p>
<h2 id="background-deploying-cuda-based-apps">Background: Deploying CUDA based apps</h2>
<p>So when I was tasked to deploy a machine learning system to a gpu cluster
running Nvidia GPUs, building a docker container was again my go-to solution. I
already knew that I would need to convince the admin to install
<a href="https://github.com/NVIDIA/nvidia-docker">nvidia-docker</a> (link to
<a href="https://github.com/NixOS/nixpkgs/blob/db3e8325a9b62b2b4fad0342f6835cb4ccc80c9b/pkgs/applications/virtualization/nvidia-docker/default.nix">nixpkgs</a>),
a docker runtime which exposes host GPUs to the containers running on it, but
this was the lesser problem.</p>
<p>CUDA itself, a widely used, proprietary library used for various computations on
Nvidia GPUs, is
<a href="https://github.com/NixOS/nixpkgs/blob/db3e8325a9b62b2b4fad0342f6835cb4ccc80c9b/pkgs/development/compilers/cudatoolkit/default.nix">already available in the nixpkgs</a>
and used in derivations which have gpu support enabled like the machine learning
library
<a href="https://github.com/NixOS/nixpkgs/blob/db3e8325a9b62b2b4fad0342f6835cb4ccc80c9b/pkgs/development/python-modules/pytorch/default.nix">pytorch</a>
(even though you&#x27;ll have to bring some patience if you want to use libraries
with cuda support, as they are unfree packages and
<a href="https://nixos.wiki/wiki/FAQ#More_precision">thus not available in the public nix binary cache</a>).</p>
<p>At first, I thought it would be an easy task: Sit through the waiting times on
my development machine to build all necessary libs with cuda support once (as
they are available in your local nix store afterwards), write a 20 line
derivation to put everything into a vanilla container and that&#x27;s it.</p>
<p>As you may have guessed by the length of the article (or the query that most
likely brought you here), this was not &quot;it&quot;. What follows is a summary of the
things I needed to do to get nvidia-cuda containers made with nix to work.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>I assume that you have a working derivation (as in: it compiles and does the
stuff you want it to do) with a dependency on cuda, which needs to be deployed
on a non NixOS Linux operating system.</p>
<p>If you struggle to get the derivation to work on you own system (without docker
involved), I&#x27;d point you over to this
<a href="https://github.com/cdepillabout/course-v3/blob/6ecf90f640f327dc05b167f45fb7ba88bc265281/default.nix#L251">derivation</a>
which builds fast.ai (a machine learning lib build on top of the aforementioned
pytorch) to get some inspiration on how to write a working wrapper for cuda
applications.</p>
<p>As a first step you should make sure that all subderivations of your final
derivation depend on the same version of cuda.</p>
<p>In theory multiple versions of cuda should not be a problem, but I got some very
consistent crashes of the nvidia-containers when they were present. I suspect
this is a issue on the driver-side. At least it should be easy to
<a href="https://nixos.org/nixpkgs/manual/#sec-pkg-overrideAttrs">overwrite</a> versions
differing from the one you want to use.</p>
<p>Also, make sure that the driver on your target host system supports the cuda
version you want to use, as this driver will later process the calls from your
docker container.</p>
<h2 id="a-few-technical-details">A few technical details</h2>
<p>First it is important to note that - in theory - every possible container can be
used with GPU support, as the
<a href="https://github.com/NVIDIA/nvidia-docker/wiki/Installation-(Native-GPU-Support)#non-cuda-image">nvidia-docker wiki states</a>.</p>
<p>This implies that no modifications to the layers of the container have to be
made in order to make it run on the GPU. This is confirmed by the README of the
underlying
<a href="https://github.com/NVIDIA/nvidia-container-runtime/tree/d95ffa54f4aec56532d1ad6350d641bc034a776f#nvidia-container-runtime">nvidia-container-runtime</a>,
which states that the container runtime only adds a
<a href="https://github.com/opencontainers/runtime-spec/blob/master/config.md#posix-platform-hooks">pre-start hook</a>
when a container is run.</p>
<p>What we have to do though is to set the correct environment variables. This is
the reason why extending the cuda base image from the docker hub does not work
when using the nix docker-tools - the docker-tools clear the environment of the
container before adding any additional layers.</p>
<p>You can find a list of <em>most</em> relevant environment variables over at the
<a href="https://github.com/NVIDIA/nvidia-container-runtime/tree/d95ffa54f4aec56532d1ad6350d641bc034a776f#environment-variables-oci-spec">container-runtime repository</a>
but this list is not complete.</p>
<p>As the runtime preStart hook mount the driver and library files of the host
system into your container you`ll have to specify where the program loader can
find the shared libraries requiered by your cuda application.</p>
<p>One way to do this is to set the <code>LD_LIBRARY_PATH</code> environment variable to the
path where the nvidia-runtime will mount them (which seems to be <code>/usr/lib64/</code>,
but I am certain there are more). You could also specify the files to load
directly using the <code>LD_PRELOAD</code> variable and there are most certainly even more
ways.</p>
<h2 id="solution">Solution</h2>
<p>A generic nix build to build nvidia-docker container is available over at
<a href="https://github.com/Staff-d/nix-cuda-docker-example">Github</a> and below. The git
also included a small demo application which is build using three versions of
CUDA to create three different docker images, so you can see it in action.</p>
<pre><code class="language-nix">{
# see https://github.com/NixOS/nixpkgs/blob/0a351c3f65136c00d3512dd77f48e12a571cf495/pkgs/build-support/docker/default.nix#L656
cudatoolkit,
buildImage,
lib,
name,
tag ? null,
fromImage ? null,
fromImageName ? null,
fromImageTag ? null,
contents ? null,
keepContentsDirlinks ? false,
config ? {Env = [];},
extraCommands ? &quot;&quot;,
uid ? 0,
gid ? 0,
runAsRoot ? null,
diskSize ? 1024,
created ? &quot;1970-01-01T00:00:01Z&quot;
}:

let

cutVersion = with lib; versionString:
builtins.concatStringsSep &quot;.&quot;
(take 3 (builtins.splitVersion versionString )
);

cudaVersionString =
&quot;CUDA_VERSION=&quot; + (cutVersion cudatoolkit.version);

cudaEnv = [
&quot;${cudaVersionString}&quot;
&quot;NVIDIA_VISIBLE_DEVICES=all&quot;
&quot;NVIDIA_DRIVER_CAPABILITIES=all&quot;

    &quot;LD_LIBRARY_PATH=/usr/lib64/&quot;
];

cudaConfig = config // {Env = cudaEnv;};

in buildImage {
inherit name tag fromImage
fromImageName fromImageTag contents
keepContentsDirlinks extraCommands
runAsRoot diskSize created;

config = cudaConfig;
}
</code></pre>
<p>As you can see, the builder is a wrapper for docker builder, which adds the
required environment variables. The builder isn&#x27;t perfect though. As your driver
version is dependent on the host system, it will not work on all machines - the
example I uploaded to github assumes your driver supports at least CUDA 10.0,
but you could downgrade this anytime. A perfect solutions would include fetching
and using the correct driver for a given CUDA version, but we hit
<a href="https://www.reddit.com/r/NixOS/comments/5p7mk1/can_nix_handle_lowlevel_dependencies_like/">end of the road here</a> -
(at least for now).</p>
<p>A simple solution one could use to at least give a immediate and readable error
message if the host CUDA version is too low is to set the
<a href="https://github.com/NVIDIA/nvidia-container-runtime/tree/d95ffa54f4aec56532d1ad6350d641bc034a776f#nvidia_require_">NVIDIA<em>REQUIRE</em>*</a>
environment variable. I may include this in the builder if I find the time and
update the git accordingly.</p>
<h2 id="credits">Credits</h2>
<ul>
<li>Dennis Gossnel&#x27;s
<a href="https://functor.tokyo/blog/2019-03-16-nix-derivation-for-fastai">Nix Derivation for fast.ai</a>,
which I used as a primer to get nix to build something with cuda support</li>
<li><a href="https://blog.galowicz.de/">tfc</a>&#x27;s
<a href="https://github.com/tfc/nix_cmake_example">Nix Cmake Example</a>, which I use as
a kind of reference work whenever I forget how to do something with Nix.</li>
<li>Cover Photo by Tri Eptaroka Mardiana on Unsplash; The NixOS logo is licensed
under the Creative Commons Attribution 4.0 International License</li>
</ul></div></article><section class="w-full py-12 md:py-24 lg:py-32 bg-gray-100 dark:bg-gray-800"><div class="container px-4 md:px-6 mx-auto"><h2 class="text-3xl font-bold tracking-tighter sm:text-5xl text-center mb-4 md:mb-6">More posts like this one</h2><div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"><div class="rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between"><div class="flex flex-col space-y-1.5 p-6"><h3 class="font-semibold leading-none tracking-tight">As a freelancer, I put my trust in NixOS. Here&#x27;s why.</h3><div class="flex items-center space-x-1 text-sm text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><time dateTime="2024-11-07T10:11:08.169Z">Nov 7, 2024, 11:11 AM</time></div></div><div class="p-6 pt-0"><p>In today&#x27;s blog I want to talk about why I have chosen NixOS as my main operating system.</p></div><div class="items-center p-6 pt-0 flex justify-between"><p class="text-sm text-gray-500">By <!-- -->Sebastian Staffa</p><a href="/posts/nixos-as-a-freelancer"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2">Read More<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right ml-2 h-4 w-4"><path d="m9 18 6-6-6-6"></path></svg></button></a></div></div><div class="rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between"><div class="flex flex-col space-y-1.5 p-6"><h3 class="font-semibold leading-none tracking-tight">On How To Lead Devs</h3><div class="flex items-center space-x-1 text-sm text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><time dateTime="2024-03-25T15:58:07.801Z">Mar 25, 2024, 4:58 PM</time></div></div><div class="p-6 pt-0"><p>After I have been entrusted with leadership responsibilities, it&#x27;s time to reflect on how not to mess it up.</p></div><div class="items-center p-6 pt-0 flex justify-between"><p class="text-sm text-gray-500">By <!-- -->Sebastian Staffa</p><a href="/posts/on-how-to-lead-devs"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2">Read More<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right ml-2 h-4 w-4"><path d="m9 18 6-6-6-6"></path></svg></button></a></div></div><div class="rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between"><div class="flex flex-col space-y-1.5 p-6"><h3 class="font-semibold leading-none tracking-tight">Azure revisited</h3><div class="flex items-center space-x-1 text-sm text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><time dateTime="2022-11-21T12:13:08.801Z">Nov 21, 2022, 1:13 PM</time></div></div><div class="p-6 pt-0"><p>A year with Azure has passed, and this is what I have learned.</p></div><div class="items-center p-6 pt-0 flex justify-between"><p class="text-sm text-gray-500">By <!-- -->Sebastian Staffa</p><a href="/posts/azure-revisited"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2">Read More<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right ml-2 h-4 w-4"><path d="m9 18 6-6-6-6"></path></svg></button></a></div></div></div></div></section></main><footer class="flex flex-col gap-2 sm:flex-row py-6 w-full shrink-0 items-center px-4 md:px-6 border-t"><p class="text-xs text-gray-500 dark:text-gray-400">© <!-- -->2024<!-- --> Sebastian Staffa.</p><nav class="sm:ml-auto flex gap-4 sm:gap-6"><a class="text-xs hover:underline underline-offset-4" href="/feed.rss">RSS</a><a class="text-xs hover:underline underline-offset-4" href="/imprint">Imprint</a></nav></footer></div><script src="/_next/static/chunks/webpack-9928534fc2156327.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"3:\"$Sreact.fragment\"\n4:I[231,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"93\",\"static/chunks/93-bef0623bae112d3c.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-b32b315fa6392c69.js\"],\"\"]\n5:I[9275,[],\"\"]\n6:I[1343,[],\"\"]\n7:I[5361,[\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"185\",\"static/chunks/app/layout-d8addcc19b69e0c2.js\"],\"default\",1]\n9:I[3120,[],\"OutletBoundary\"]\nb:I[3120,[],\"MetadataBoundary\"]\nd:I[3120,[],\"ViewportBoundary\"]\nf:I[6130,[],\"\"]\n1:HL[\"/_next/static/media/d4834662e8b5d3f9-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n2:HL[\"/_next/static/css/362dd02c7d987ff9.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"HHqWtBUWyAPmUb8Op0hK2\",\"p\":\"\",\"c\":[\"\",\"posts\",\"nvidia-docker-with-nix\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"nvidia-docker-with-nix\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"nvidia-docker-with-nix\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$3\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/362dd02c7d987ff9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__variable_4eb141\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col min-h-screen\",\"children\":[[\"$\",\"header\",null,{\"className\":\"px-4 lg:px-6 h-14 flex items-center\",\"children\":[[\"$\",\"$L4\",null,{\"className\":\"flex items-center justify-center\",\"href\":\"/\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-book-open h-6 w-6\",\"children\":[[\"$\",\"path\",\"1akyts\",{\"d\":\"M12 7v14\"}],[\"$\",\"path\",\"ruj8y\",{\"d\":\"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"Acme Blog\"}]]}],[\"$\",\"nav\",null,{\"className\":\"ml-auto flex gap-4 sm:gap-6\",\"children\":[[\"$\",\"$L4\",null,{\"className\":\"text-sm font-medium hover:underline underline-offset-4\",\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L4\",null,{\"className\":\"text-sm font-medium hover:underline underline-offset-4\",\"href\":\"/contact\",\"children\":\"Contact\"}],[\"$\",\"$L4\",null,{\"className\":\"text-sm font-medium hover:underline underline-offset-4\",\"href\":\"/posts\",\"children\":\"Blog\"}]]}]]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}],[\"$\",\"$L7\",null,{}],[\"$\",\"footer\",null,{\"className\":\"flex flex-col gap-2 sm:flex-row py-6 w-full shrink-0 items-center px-4 md:px-6 border-t\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-xs text-gray-500 dark:text-gray-400\",\"children\":[\"© \",2024,\" Sebastian Staffa.\"]}],[\"$\",\"nav\",null,{\"className\":\"sm:ml-auto flex gap-4 sm:gap-6\",\"children\":[[\"$\",\"$L4\",null,{\"className\":\"text-xs hover:underline underline-offset-4\",\"href\":\"/feed.rss\",\"prefetch\":false,\"children\":\"RSS\"}],[\"$\",\"$L4\",null,{\"className\":\"text-xs hover:underline underline-offset-4\",\"href\":\"/imprint\",\"children\":\"Imprint\"}]]}]]}]]}]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"nvidia-docker-with-nix\",\"d\"],[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$3\",\"c\",{\"children\":[\"$L8\",null,[\"$\",\"$L9\",null,{\"children\":\"$La\"}]]}],{},null]},null]},null]},null],[\"$\",\"$3\",\"h\",{\"children\":[null,[\"$\",\"$3\",\"7tyK68tDtw2gkDsbmUOD1\",{\"children\":[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":\"$f\",\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:I[3421,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"93\",\"static/chunks/93-bef0623bae112d3c.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-b32b315fa6392c69.js\"],\"Avatar\",1]\n11:I[3421,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"93\",\"static/chunks/93-bef0623bae112d3c.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-b32b315fa6392c69.js\"],\"AvatarImage\",1]\n12:I[3421,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"93\",\"static/chunks/93-bef0623bae112d3c.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-b32b315fa6392c69.js\"],\"AvatarFallback\",1]\n13:I[8173,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"93\",\"static/chunks/93-bef0623bae112d3c.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-b32b315fa6392c69.js\"],\"Image\"]\n14:I[5025,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"93\",\"static/chunks/93-bef0623bae112d3c.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-b32b315fa6392c69.js\"],\"PreloadChunks\"]\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"suppressHydrationWarning\":true,\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Building nvidia-docker containers with nix\\\",\\\"datePublished\\\":\\\"2020-03-09T20:33:10+01:00\\\",\\\"dateModified\\\":\\\"2020-03-09T20:33:10+01:00\\\",\\\"description\\\":\\\"A practical guide on how to package your cuda dependent application build with nix into a docker container.\\\",\\\"image\\\":\\\"https://sebastian-staffa.eu/images/gpu-container-header.webp\\\",\\\"url\\\":\\\"https://sebastian-staffa.eu/posts/nvidia-docker-with-nix\\\",\\\"author\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Sebastian Staffa\\\"}}\"}}],[\"$\",\"article\",null,{\"className\":\"container max-w-3xl px-4 py-6 lg:py-12 mx-auto\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl lg:text-6xl/none mb-4\",\"children\":\"Building nvidia-docker containers with nix\"}],false,[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 mb-4\",\"children\":[[\"$\",\"$L10\",null,{\"children\":[[\"$\",\"$L11\",null,{\"src\":\"/_next/static/media/portrait-ico.778fd454.webp\",\"alt\":\"Avatar of Sebastian Staffa\"}],[\"$\",\"$L12\",null,{\"children\":\"S\"}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm font-medium\",\"children\":\"Sebastian Staffa\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500 flex flex-row align-baseline\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar inline-block w-4 h-4 mr-1\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],\"Published on\",\" \",\"Mar 9, 2020, 8:33 PM\"]}]]}]]}],[\"$\",\"$L13\",null,{\"src\":{\"src\":\"/_next/static/media/gpu-container-header.339b8b2a.webp\",\"height\":485,\"width\":1080,\"blurDataURL\":\"data:image/webp;base64,UklGRkwAAABXRUJQVlA4IEAAAACwAQCdASoIAAQAAkA4JYgCdADdA7QwAP4nnjNSopA8KLrBOxCQl5jhW/ME/J9FOdJVAd5U8wMYxo07qbj5AAAA\",\"blurWidth\":8,\"blurHeight\":4},\"alt\":\"Photo by Tri Eptaroka Mardiana on Unsplash; The NixOS logo is licensed under the Creative Commons Attribution 4.0 International License\",\"className\":\"rounded-lg object-cover w-full mb-8\",\"priority\":true}],[\"$\",\"div\",null,{\"className\":\"prose max-w-none\",\"children\":[[\"$\",\"$L14\",null,{\"moduleIds\":\"$undefined\"}],\"$L15\"]}]]}],\"$L16\"]}]\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"p\",null,{\"children\":\"How to convert the output of a derivation into a self contained package is one\\nof the most important questions when developing productive Software with nix,\\neven for prototype applications. If the system you need to deploy to is not\\nunder your control, nix is probably not installed and will not be in the\\nimmediate future.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"To avoid having to beg an admin I don't even know personally to install nix on\\nsome remote system I have no root access to, I usually just\\n\",[\"$\",\"a\",null,{\"href\":\"https://nixos.org/nixpkgs/manual/#sec-pkgs-dockerTools\",\"children\":\"build a docker container\"}],\".\\nDocker is, as of today, a tool most sys admins know and trust, and if it isn't\\ninstalled already it shouldn't be a problem to convince them to do so. At least\\nif you want to deploy server applications that is, but you can always use\\n\",[\"$\",\"a\",null,{\"href\":\"https://nixos.org/nixpkgs/manual/#sec-pkgs-appimageTools\",\"children\":\"AppImages\"}],\" as a\\nreplacement if you need to deploy user applications.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"background-deploying-cuda-based-apps\",\"children\":\"Background: Deploying CUDA based apps\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"So when I was tasked to deploy a machine learning system to a gpu cluster\\nrunning Nvidia GPUs, building a docker container was again my go-to solution. I\\nalready knew that I would need to convince the admin to install\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NVIDIA/nvidia-docker\",\"children\":\"nvidia-docker\"}],\" (link to\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NixOS/nixpkgs/blob/db3e8325a9b62b2b4fad0342f6835cb4ccc80c9b/pkgs/applications/virtualization/nvidia-docker/default.nix\",\"children\":\"nixpkgs\"}],\"),\\na docker runtime which exposes host GPUs to the containers running on it, but\\nthis was the lesser problem.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"CUDA itself, a widely used, proprietary library used for various computations on\\nNvidia GPUs, is\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NixOS/nixpkgs/blob/db3e8325a9b62b2b4fad0342f6835cb4ccc80c9b/pkgs/development/compilers/cudatoolkit/default.nix\",\"children\":\"already available in the nixpkgs\"}],\"\\nand used in derivations which have gpu support enabled like the machine learning\\nlibrary\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NixOS/nixpkgs/blob/db3e8325a9b62b2b4fad0342f6835cb4ccc80c9b/pkgs/development/python-modules/pytorch/default.nix\",\"children\":\"pytorch\"}],\"\\n(even though you'll have to bring some patience if you want to use libraries\\nwith cuda support, as they are unfree packages and\\n\",[\"$\",\"a\",null,{\"href\":\"https://nixos.wiki/wiki/FAQ#More_precision\",\"children\":\"thus not available in the public nix binary cache\"}],\").\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At first, I thought it would be an easy task: Sit through the waiting times on\\nmy development machine to build all necessary libs with cuda support once (as\\nthey are available in your local nix store afterwards), write a 20 line\\nderivation to put everything into a vanilla container and that's it.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you may have guessed by the length of the article (or the query that most\\nlikely brought you here), this was not \\\"it\\\". What follows is a summary of the\\nthings I needed to do to get nvidia-cuda containers made with nix to work.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"prerequisites\",\"children\":\"Prerequisites\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I assume that you have a working derivation (as in: it compiles and does the\\nstuff you want it to do) with a dependency on cuda, which needs to be deployed\\non a non NixOS Linux operating system.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you struggle to get the derivation to work on you own system (without docker\\ninvolved), I'd point you over to this\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/cdepillabout/course-v3/blob/6ecf90f640f327dc05b167f45fb7ba88bc265281/default.nix#L251\",\"children\":\"derivation\"}],\"\\nwhich builds fast.ai (a machine learning lib build on top of the aforementioned\\npytorch) to get some inspiration on how to write a working wrapper for cuda\\napplications.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As a first step you should make sure that all subderivations of your final\\nderivation depend on the same version of cuda.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In theory multiple versions of cuda should not be a problem, but I got some very\\nconsistent crashes of the nvidia-containers when they were present. I suspect\\nthis is a issue on the driver-side. At least it should be easy to\\n\",[\"$\",\"a\",null,{\"href\":\"https://nixos.org/nixpkgs/manual/#sec-pkg-overrideAttrs\",\"children\":\"overwrite\"}],\" versions\\ndiffering from the one you want to use.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Also, make sure that the driver on your target host system supports the cuda\\nversion you want to use, as this driver will later process the calls from your\\ndocker container.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"a-few-technical-details\",\"children\":\"A few technical details\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"First it is important to note that - in theory - every possible container can be\\nused with GPU support, as the\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NVIDIA/nvidia-docker/wiki/Installation-(Native-GPU-Support)#non-cuda-image\",\"children\":\"nvidia-docker wiki states\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This implies that no modifications to the layers of the container have to be\\nmade in order to make it run on the GPU. This is confirmed by the README of the\\nunderlying\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NVIDIA/nvidia-container-runtime/tree/d95ffa54f4aec56532d1ad6350d641bc034a776f#nvidia-container-runtime\",\"children\":\"nvidia-container-runtime\"}],\",\\nwhich states that the container runtime only adds a\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/opencontainers/runtime-spec/blob/master/config.md#posix-platform-hooks\",\"children\":\"pre-start hook\"}],\"\\nwhen a container is run.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"What we have to do though is to set the correct environment variables. This is\\nthe reason why extending the cuda base image from the docker hub does not work\\nwhen using the nix docker-tools - the docker-tools clear the environment of the\\ncontainer before adding any additional layers.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You can find a list of \",[\"$\",\"em\",null,{\"children\":\"most\"}],\" relevant environment variables over at the\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NVIDIA/nvidia-container-runtime/tree/d95ffa54f4aec56532d1ad6350d641bc034a776f#environment-variables-oci-spec\",\"children\":\"container-runtime repository\"}],\"\\nbut this list is not complete.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As the runtime preStart hook mount the driver and library files of the host\\nsystem into your container you`ll have to specify where the program loader can\\nfind the shared libraries requiered by your cuda application.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"One way to do this is to set the \",[\"$\",\"code\",null,{\"children\":\"LD_LIBRARY_PATH\"}],\" environment variable to the\\npath where the nvidia-runtime will mount them (which seems to be \",[\"$\",\"code\",null,{\"children\":\"/usr/lib64/\"}],\",\\nbut I am certain there are more). You could also specify the files to load\\ndirectly using the \",[\"$\",\"code\",null,{\"children\":\"LD_PRELOAD\"}],\" variable and there are most certainly even more\\nways.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"solution\",\"children\":\"Solution\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A generic nix build to build nvidia-docker container is available over at\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/Staff-d/nix-cuda-docker-example\",\"children\":\"Github\"}],\" and below. The git\\nalso included a small demo application which is build using three versions of\\nCUDA to create three different docker images, so you can see it in action.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-nix\",\"children\":\"{\\n# see https://github.com/NixOS/nixpkgs/blob/0a351c3f65136c00d3512dd77f48e12a571cf495/pkgs/build-support/docker/default.nix#L656\\ncudatoolkit,\\nbuildImage,\\nlib,\\nname,\\ntag ? null,\\nfromImage ? null,\\nfromImageName ? null,\\nfromImageTag ? null,\\ncontents ? null,\\nkeepContentsDirlinks ? false,\\nconfig ? {Env = [];},\\nextraCommands ? \\\"\\\",\\nuid ? 0,\\ngid ? 0,\\nrunAsRoot ? null,\\ndiskSize ? 1024,\\ncreated ? \\\"1970-01-01T00:00:01Z\\\"\\n}:\\n\\nlet\\n\\ncutVersion = with lib; versionString:\\nbuiltins.concatStringsSep \\\".\\\"\\n(take 3 (builtins.splitVersion versionString )\\n);\\n\\ncudaVersionString =\\n\\\"CUDA_VERSION=\\\" + (cutVersion cudatoolkit.version);\\n\\ncudaEnv = [\\n\\\"${cudaVersionString}\\\"\\n\\\"NVIDIA_VISIBLE_DEVICES=all\\\"\\n\\\"NVIDIA_DRIVER_CAPABILITIES=all\\\"\\n\\n    \\\"LD_LIBRARY_PATH=/usr/lib64/\\\"\\n];\\n\\ncudaConfig = config // {Env = cudaEnv;};\\n\\nin buildImage {\\ninherit name tag fromImage\\nfromImageName fromImageTag contents\\nkeepContentsDirlinks extraCommands\\nrunAsRoot diskSize created;\\n\\nconfig = cudaConfig;\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"As you can see, the builder is a wrapper for docker builder, which adds the\\nrequired environment variables. The builder isn't perfect though. As your driver\\nversion is dependent on the host system, it will not work on all machines - the\\nexample I uploaded to github assumes your driver supports at least CUDA 10.0,\\nbut you could downgrade this anytime. A perfect solutions would include fetching\\nand using the correct driver for a given CUDA version, but we hit\\n\",[\"$\",\"a\",null,{\"href\":\"https://www.reddit.com/r/NixOS/comments/5p7mk1/can_nix_handle_lowlevel_dependencies_like/\",\"children\":\"end of the road here\"}],\" -\\n(at least for now).\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A simple solution one could use to at least give a immediate and readable error\\nmessage if the host CUDA version is too low is to set the\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/NVIDIA/nvidia-container-runtime/tree/d95ffa54f4aec56532d1ad6350d641bc034a776f#nvidia_require_\",\"children\":[\"NVIDIA\",[\"$\",\"em\",null,{\"children\":\"REQUIRE\"}],\"*\"]}],\"\\nenvironment variable. I may include this in the builder if I find the time and\\nupdate the git accordingly.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"credits\",\"children\":\"Credits\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Dennis Gossnel's\\n\",[\"$\",\"a\",null,{\"href\":\"https://functor.tokyo/blog/2019-03-16-nix-derivation-for-fastai\",\"children\":\"Nix Derivation for fast.ai\"}],\",\\nwhich I used as a primer to get nix to build something with cuda support\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://blog.galowicz.de/\",\"children\":\"tfc\"}],\"'s\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/tfc/nix_cmake_example\",\"children\":\"Nix Cmake Example\"}],\", which I use as\\na kind of reference work whenever I forget how to do something with Nix.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Cover Photo by Tri Eptaroka Mardiana on Unsplash; The NixOS logo is licensed\\nunder the Creative Commons Attribution 4.0 International License\"}],\"\\n\"]}]]\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"section\",null,{\"className\":\"w-full py-12 md:py-24 lg:py-32 bg-gray-100 dark:bg-gray-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"container px-4 md:px-6 mx-auto\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-3xl font-bold tracking-tighter sm:text-5xl text-center mb-4 md:mb-6\",\"children\":\"More posts like this one\"}],[\"$\",\"div\",null,{\"className\":\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\",\"children\":[[\"$\",\"div\",\"nixos-as-a-freelancer\",{\"ref\":\"$undefined\",\"className\":\"rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between\",\"children\":[[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"flex flex-col space-y-1.5 p-6\",\"children\":[[\"$\",\"h3\",null,{\"ref\":\"$undefined\",\"className\":\"font-semibold leading-none tracking-tight\",\"children\":\"As a freelancer, I put my trust in NixOS. Here's why.\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-1 text-sm text-gray-500\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-11-07T10:11:08.169Z\",\"children\":\"Nov 7, 2024, 11:11 AM\"}]]}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-0\",\"children\":[\"$\",\"p\",null,{\"children\":\"In today's blog I want to talk about why I have chosen NixOS as my main operating system.\"}]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"items-center p-6 pt-0 flex justify-between\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500\",\"children\":[\"By \",\"Sebastian Staffa\"]}],[\"$\",\"$L4\",null,{\"href\":\"/posts/nixos-as-a-freelancer\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2\",\"ref\":\"$undefined\",\"children\":[\"Read More\",[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-right ml-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"mthhwq\",{\"d\":\"m9 18 6-6-6-6\"}],\"$undefined\"]}]]}]}]]}]]}],[\"$\",\"div\",\"on-how-to-lead-devs\",{\"ref\":\"$undefined\",\"className\":\"rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between\",\"children\":[[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"flex flex-col space-y-1.5 p-6\",\"children\":[[\"$\",\"h3\",null,{\"ref\":\"$undefined\",\"className\":\"font-semibold leading-none tracking-tight\",\"children\":\"On How To Lead Devs\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-1 text-sm text-gray-500\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-03-25T15:58:07.801Z\",\"children\":\"Mar 25, 2024, 4:58 PM\"}]]}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-0\",\"children\":[\"$\",\"p\",null,{\"children\":\"After I have been entrusted with leadership responsibilities, it's time to reflect on how not to mess it up.\"}]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"items-center p-6 pt-0 flex justify-between\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500\",\"children\":[\"By \",\"Sebastian Staffa\"]}],[\"$\",\"$L4\",null,{\"href\":\"/posts/on-how-to-lead-devs\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2\",\"ref\":\"$undefined\",\"children\":[\"Read More\",[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-right ml-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"mthhwq\",{\"d\":\"m9 18 6-6-6-6\"}],\"$undefined\"]}]]}]}]]}]]}],[\"$\",\"div\",\"azure-revisited\",{\"ref\":\"$undefined\",\"className\":\"rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between\",\"children\":[[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"flex flex-col space-y-1.5 p-6\",\"children\":[[\"$\",\"h3\",null,{\"ref\":\"$undefined\",\"className\":\"font-semibold leading-none tracking-tight\",\"children\":\"Azure revisited\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-1 text-sm text-gray-500\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2022-11-21T12:13:08.801Z\",\"children\":\"Nov 21, 2022, 1:13 PM\"}]]}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-0\",\"children\":[\"$\",\"p\",null,{\"children\":\"A year with Azure has passed, and this is what I have learned.\"}]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"items-center p-6 pt-0 flex justify-between\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500\",\"children\":[\"By \",\"Sebastian Staffa\"]}],[\"$\",\"$L4\",null,{\"href\":\"/posts/azure-revisited\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2\",\"ref\":\"$undefined\",\"children\":[\"Read More\",[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-right ml-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"mthhwq\",{\"d\":\"m9 18 6-6-6-6\"}],\"$undefined\"]}]]}]}]]}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Building nvidia-docker containers with nix\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"A practical guide on how to package your cuda dependent application build with nix into a docker container.\"}]]\n"])</script><script>self.__next_f.push([1,"a:null\n"])</script></body></html>