<!DOCTYPE html><html lang="en" class="__variable_4eb141"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/d4834662e8b5d3f9-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="preload" as="image" href="/_next/static/media/happy-mqtt-big.a9198661.webp"/><link rel="stylesheet" href="/_next/static/css/f02cf5e1e4530fa1.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-9928534fc2156327.js"/><script src="/_next/static/chunks/4bd1b696-3671cad27c05b2f2.js" async=""></script><script src="/_next/static/chunks/215-a9568644c260d23b.js" async=""></script><script src="/_next/static/chunks/main-app-00046220a614ac05.js" async=""></script><script src="/_next/static/chunks/173-ffd0b8113e523dc5.js" async=""></script><script src="/_next/static/chunks/536-d4fee2fe7c6d19de.js" async=""></script><script src="/_next/static/chunks/884-c50d8beb1ec70a5a.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-ff0103dd57687992.js" async=""></script><script src="/_next/static/chunks/app/layout-d8addcc19b69e0c2.js" async=""></script><meta name="next-size-adjust"/><title>MQTT For Web Developers</title><meta name="description" content="MQTT is a protocol that is typically used in an IoT context. In this article, we&#x27;ll explore how we could use its capabilities in a traditional web application to stream messages in real-time."/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div class="flex flex-col min-h-screen"><header class="px-4 lg:px-6 h-14 flex items-center"><a class="flex items-center justify-center" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open h-6 w-6"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg><span class="sr-only">Acme Blog</span></a><nav class="ml-auto flex gap-4 sm:gap-6"><a class="text-sm font-medium hover:underline underline-offset-4" href="/">Home</a><a class="text-sm font-medium hover:underline underline-offset-4" href="/contact">Contact</a><a class="text-sm font-medium hover:underline underline-offset-4" href="/posts">Blog</a></nav></header><main class="flex-1"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"MQTT For Web Developers","datePublished":"2024-11-20T16:13:52.889Z","dateModified":"2024-11-20T16:13:52.889Z","description":"MQTT is a protocol that is typically used in an IoT context. In this article, we'll explore how we could use its capabilities in a traditional web application to stream messages in real-time.","image":"https://sebastian-staffa.eu/images/happy-mqtt-big.webp","url":"https://sebastian-staffa.eu/posts/mqtt-for-webdevs","author":{"@type":"Person","name":"Sebastian Staffa"}}</script><article class="container max-w-3xl px-4 py-6 lg:py-12 mx-auto"><h1 class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl lg:text-6xl/none mb-4">MQTT For Web Developers</h1><div class="flex items-center space-x-4 mb-4"><span class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"><span class="flex h-full w-full items-center justify-center rounded-full bg-muted">S</span></span><div><p class="text-sm font-medium">Sebastian Staffa</p><p class="text-sm text-gray-500 flex flex-row align-baseline"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar inline-block w-4 h-4 mr-1"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg>Published on<!-- --> <!-- -->Nov 20, 2024, 5:13 PM</p></div></div><img alt="An illustration of a happy cellular tower, generated by OpenAI&#x27;s GPT-4o" width="2048" height="1024" decoding="async" data-nimg="1" class="rounded-lg object-cover w-full mb-8" style="color:transparent" src="/_next/static/media/happy-mqtt-big.a9198661.webp"/><div class="prose max-w-none"><h2 id="what-is-this-about">What is this about?</h2>
<p>During this year&#x27;s <a href="https://www.unkonf.de">unKonf</a>, an
<a href="https://en.wikipedia.org/wiki/Unconference">unconference</a> taking place in the
German city of Mannheim, I prepared a quick talk about MQTT and how it could be
used in web applications. This article is a written, improved version of this
talk, taking into account all the feedback that I received.</p>
<p>The Message Queuing Telemetry Transport protocol, or MQTT for short, is a
protocol that delivers messages between clients via a central broker. It was
initially designed for low-bandwidth, high-latency networks (like cellular) to
be used directly on top of TCP, and optimized for clients with low storage and
computing capabilities (like embedded devices) but can also be used on top of
Websockets. This enables us to use MQTT in traditional web applications.</p>
<p>This article will focus on exactly that by designing a chat application using
MQTT 3.1.1 as a practical example. I&#x27;ve also implemented this app using
<a href="https://www.npmjs.com/package/mqtt">mqtt.js</a>, <a href="https://react.dev/">react</a>,
<a href="https://ui.shadcn.com/">shadcn</a>, <a href="https://tailwindcss.com/">tailwind</a> and the
<a href="https://redux-toolkit.js.org/">redux-toolkit</a> to build the frontend and
<a href="https://mosquitto.org/">mosquitto</a> as the MQTT broker. You can check out the
repository <a href="https://github.com/Staff-d/mqtt-chat">here</a> if you want to play
along, but I have also included screen recordings of the app at the end of every
chapter.</p>
<h2 id="why-should-you-care">Why should you care?</h2>
<p>MQTT comes with many features that allow its users to build robust and scalable
messaging systems without writing any backend code. Features provided by the
protocol include the ability for clients to selectively choose messages relevant
to them at any given time and the option to define a measure of importance for
each message, controlling how hard all participants should try to deliver it.
The websocket operation mode allows us to integrate it directly into web
applications, making it ideal for building systems that display various types of
real-time information from multiple sources to many clients simultaneously.</p>
<h2 id="mqtt-basics">MQTT Basics</h2>
<p>MQTT governs the communication between message senders, a central broker that
distributes these messages, and message receivers. There are no direct
connections between MQTT clients: Every message is proxied via the broker.</p>
<p>Every MQTT connection starts with a <code>connect</code> handshake between a client and the
broker. The simplest form of this handshake does not contain much besides a
session identifier to identify the running session.</p>
<p>After a connection is established, the server periodically sends pings to the
client to determine whether the client is still alive. The interval in which
these pings are sent can be configured by the client with the <code>connect</code> package.</p>
<h2 id="sending-and-receiving-messages">Sending And Receiving Messages</h2>
<p>When clients want to send a message, they can send a <code>publish</code> package to the
broker. This package contains the message payload and is addressed to a topic.
Topics are hierarchical strings and, similar to a file path, separated by
slashes, e.g. <code>room/hallway/temperature</code>.</p>
<p>The message is then forwarded by the broker to all clients that are subscribed
to this topic. A client subscribes to a topic by sending a <code>subscribe</code> message
to the broker that either contains a topic or a topic pattern. A topic pattern
can contain two different kinds of wildcard characters: <code>+</code> and <code>#</code>. The <code>+</code>
character matches exactly one level of the topic hierarchy and can be used
multiple times, while the <code>#</code> character matches any number of levels and must be
the last character of a pattern string. Both wildcards can only match a complete
level of the topic hierarchy, which means that <code>room/hall+</code> would be an invalid
pattern. The following subscription patterns would match the message sent to the
topic <code>room/hallway/temperature</code>:</p>
<pre><code>// Examples of VALID patterns that match room/hallway/temperature
// Complete topic
room/hallway/temperature
// One single level wildcard
room/hallway/+
// One single level wildcard that matches every temperature topic
room/+/temperature
// Two single level wildcards that match every message in every room
room/+/+
// Three single level wildcards that match every message sent on the broker
// with three hierarchy levels
+/+/+
// Multilevel wildcard for all topics that start with room/
room/#
// The single multilevel wildcard matches all topics on a broker
#

// Examples of INVALID patterns
// A multilevel wildcard is not last character of the pattern
room/#/temperature
// Multiple multilevel wildcards are not allowed
room/#/#
// Wildcards can only be used to match complete levels
room/hall+/temperature
</code></pre>
<p>With these three building blocks (a session identifier, the publish and
subscribe commands) we can build a simple chat application. This application
would work as follows:</p>
<ul>
<li>A user can choose any username, which the application will use as the MQTT
session identifier (this will be important later)</li>
<li>By convention, a user can send messages to any other user by publishing a
message to the topic <code>chat/messages/[receiver]/[sender]</code></li>
<li>To receive messages, a user subscribes to the topic
<code>chat/messages/[username]/+</code> to get all the messages that are addressed to
themselves.</li>
</ul>
<p>If you are running the <a href="https://github.com/Staff-d/mqtt-chat">demo</a> application,
you can try out this first implementation of our chat app by navigating to
<a href="http://localhost:5173/?stage=10"><code>http://localhost:5173/?stage=10</code></a> and
entering any name to login and start chatting.</p>
<video controls="" preload="metadata" muted="" loop="" class="w-full"><source src="/videos/stage-10-fast.webm" type="video/webm"/><p>Your browser does not support the video tag.</p></video>
<h2 id="quality-of-service-qos">Quality of Service (QoS)</h2>
<p>When a message is published to a MQTT topic, the sender can specify a Quality of
Service (QoS) level. When a client subscribes to a topic, a QoS value can also
be specified which determines the maximum QoS level that is delivered to this
subscription. Colloquially speaking, the QoS value determines how hard the MQTT
broker should try to deliver the message: the higher the QoS, the harder the
broker tries. If the QoS level of a subscription is lower than the QoS level of
a message that should be sent to a subscription, the broker downgrades the QoS
of the message to match the one of the subscription.</p>
<p>Before we take a look at the different QoS levels, it is important to talk about
the definition of &quot;delivering&quot; a message. In the MQTT-sense, a message is
considered to be delivered when the sender has tried its best to send the
message (in the case of QoS0) or after the package has been acknowledged via
some kind of <code>ack</code> packet (in the case of QoS1/2). As both of these actions
occur before the data is passed to the receiving application, MQTT cannot manage
message <strong>processing</strong>. If the client crashes immediately after receiving the
message, the message is still considered delivered. This is different from other
message queuing systems, such as RabbitMQ, where messages can be redelivered if
the processing of the message failed.</p>
<h3 id="qos-0-deliver-at-most-once">QoS 0: Deliver At Most Once</h3>
<p>QoS 0 is the default value for many MQTT clients when publishing a message. On
this level, the message is delivered in a best effort fashion, but both the
client and broker can to drop the message if they cannot deliver it on the first
try for any reason. Typical cases when messages are dropped are when the client
is offline, the network is congested or the broker is overloaded.</p>
<p>In our chat application we could use QoS 0 for informational messages, like the
information about when a user comes online or goes offline. We won&#x27;t implement
this right away, but keep this in mind for later.</p>
<h3 id="qos-1-deliver-at-least-once">QoS 1: Deliver At Least Once</h3>
<p>At QoS 1, the published message is delivered at least once, but may be delivered
multiple times. At this level, many client libraries implement a message queue
to keep track of the messages that have not yet been acknowledged by the broker.
Brokers now require a client to send an <code>puback</code> package to confirm that it has
successfully received the package. They also start to keep track of which
messages have been delivered to which sessions based on the session identifier,
so that they can resend the message if a client is not online when a new message
is published.</p>
<p>It is important to note that, even though it is widely supported, this feature
of storing messages for offline clients (called session persistence) is not
required for a MQTT-compliant broker. The
<a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Storing_state">section 4.1 of the standard states</a>
that</p>
<blockquote>
<p>The Client and Server MUST store Session state for the entire duration of the
Session. A Session MUST last at least as long it has an active Network
Connection.</p>
</blockquote>
<p>Until now, our chat application had the problem that messages can only be
delivered when the receiver is online. By using session persistence and QoS 1
messages we can make sure that every chat message arrives at the receiver at
least once. On the other hand we don&#x27;t care about redeliveries, because we can
easily deduplicate the message on the client side, so we don&#x27;t need QoS 2 (see
below).</p>
<p>If you are running the <a href="https://github.com/Staff-d/mqtt-chat">demo</a> application,
you can try out this improved implementation of our chat app by navigating to
<a href="http://localhost:5173/?stage=20"><code>http://localhost:5173/?stage=20</code></a> or check
the <code>Use QoS 1</code> checkbox. You can still enter any name to login, but whenever
you close a chat window and login again, you will receive all the messages that
have been sent to you while you were offline.</p>
<video controls="" preload="metadata" muted="" loop="" class="w-full"><source src="/videos/stage-20-fast.webm" type="video/webm"/><p>Your browser does not support the video tag.</p></video>
<h3 id="qos-2-deliver-exactly-once">QoS 2: Deliver Exactly Once</h3>
<p>QoS 2 is the strictest of the three QoS levels. At this level, each message is
delivered exactly once to every receiver. This is asserted by a two-way
handshake that is performed whenever a message is delivered.</p>
<p>This quality level is not implemented by many brokers because it is the most
expensive in terms of state management. For many MQTT use cases, it also not
that useful because the use case can often be modeled with QoS 1 messages and
client-side deduplication.</p>
<h2 id="retained-messages">Retained Messages</h2>
<p>While publishing a message, a client can specify an additional parameter besides
the topic, payload and QoS: the retain flag. If this feature is enabled on the
broker and the retain flag is set, the message is stored on the given topic.
This means that every client that subscribes to this topic will receive the last
retained message that has been sent to this topic.</p>
<p>It is important to note that retained messages are kept independently of the
sessions state of the sender, meaning that retained messages are kept even is
session state is discarded.</p>
<p>In our chat application, we can use retained messages to display the
online/offline status of a user. Whenever our client application connects to the
broker successfully, we send a message of the following form on the topic
<code>chat/status/[username]</code> using <strong>QoS 0</strong> and the retain flag set:</p>
<pre><code class="language-javascript">{
    status: &quot;online&quot;,
    lastOnlineTimestamp: DateTime.now().toISO(),
}
</code></pre>
<p>Whenever a user wants to disconnect by clicking the logout button, we switch our
status to offline by publishing:</p>
<pre><code class="language-javascript">{
    status: &quot;offline&quot;,
    lastOnlineTimestamp: DateTime.now().toISO(),
}
</code></pre>
<p>Now, whenever a client subscribes to the topic <code>chat/status/+</code>, they will
receive the last status update of every client that is registered with the
server. As we only care for the newest status information, we choose QoS 0 for
the status messages. With a higher QoS the broker would queue the message for
delivery for clients that are offline, which would then receive a boatload of
outdated status updates when they reconnect. QoS 0 guarantees that older status
updates are discarded when a subscriber is offline, and only the newest status
update is delivered when they resubscribe.</p>
<h2 id="last-will-and-testament-lwt">Last Will And Testament (LWT)</h2>
<p>A MQTT client can specify a last will as a part of the <code>connect</code> packet when
connecting to the broker. This feature allows a client to request the broker to
send one final message should the connection between the two be interrupted
unexpectedly, for example by a client that crashes or a network outage. A last
will consists of everything that is needed to send a normal message: a topic, a
payload, a QoS level and the retain flag.</p>
<p>However, it is important to note that the LWT only triggers during abnormal
disconnects. If a client disconnects in a graceful manner, the LWT will not be
sent.</p>
<p>In our chat application we can use the LWT to make our status feature more
robust. Currently, we cannot send a status update to set the status of a user to
<code>offline</code> when a user just closes the browser tab. With LWT, we can fix this
issue: during connection to the broker, we specify that an <code>offline</code> status
update should be sent to the status topic, with the same parameters (QoS,
retain) as we would use for a normal status update:</p>
<pre><code class="language-typescript">let will: IClientOptions[&quot;will&quot;] | undefined = undefined
// ...
const willMessage: WireStatusMessage = {
  status: &quot;offline&quot;,
  lastOnlineTimestamp: DateTime.now().toISO(),
}

will = {
  topic: `chat/status/${action.payload.credentials.username}`,
  payload: Buffer.from(JSON.stringify(willMessage)),
  qos: 0,
  retain: true,
}
</code></pre>
<p>The downside of this approach is that we cannot update the timestamp in the
status message, as the LWT cannot be updated after it was initially set without
disconnecting and reconnecting to the broker.</p>
<p>The <a href="https://github.com/Staff-d/mqtt-chat">demo</a> application provides this
feature set with the toggle <code>use status messages</code>, available via
<a href="http://localhost:5173/?stage=30"><code>http://localhost:5173/?stage=30</code></a>. Every chat
should now display a status badge next to the name of the chat participant that
updates whenever a user logs in or out of the app.</p>
<video controls="" preload="metadata" muted="" loop="" class="w-full"><source src="/videos/stage-30-fast.webm" type="video/webm"/><p>Your browser does not support the video tag.</p></video>
<h2 id="authentication">Authentication</h2>
<p>In the MQTT ecosystem, two kinds of authentication are in widespread use:
Password-based and certificate-based authentication.</p>
<p>The first one is defined in the MQTT standard: In the initial connect package,
the client can include a password and a username. The problem with this approach
is that both username and password are sent in plaintext, which becomes a
security liability if as the transport layer is unencrypted too.</p>
<p>The second option, which is not standardized but de-facto supported on almost
every broker, is to use client-certificates. This approach uses a feature of the
TLS protocol (so it is only available if MQTT is running on top of TLS, in which
case it is often called MQTTS), that requires the TLS client to present a
<a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Client-authenticated_TLS_handshake">certificate during the TLS handshake</a>.
Client certificates are more difficult to set up initially, but can save a lot
of headache further down the line for two reasons. First, the TLS handshake uses
a challenge mechanism to verify the client certificate, which means that no
confidential data is exchanged in plaintext. Second, using client certificates
relieves the broker operator from the burden of maintaining the list of
username/password pairs at the MQTT broker or, especially in the web application
context where user information might be kept in an external database, from
synchronizing it with external data sources. Instead of checking the identity of
each certificate individually, the broker can use the certificate&#x27;s chain of
trust to verify the validity of the certificate by checking it against the
public key of a root certificate that was used to sign the client certificate.</p>
<h2 id="authorization">Authorization</h2>
<p>Until now, a client could just send messages to any MQTT topic, which means that
they could easily impersonate another user. With authentication in place, we can
now ensure that users can only send messages with themselves as the sender by
defining authorization rules.</p>
<p>Unfortunately, authorization is not part of the MQTT standard. As stated by
section
<a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc385349387">5.4.2 of the standard</a></p>
<blockquote>
<p>An implementation may restrict access to Server resources based on information
provided by the Client</p>
</blockquote>
<p>That&#x27;s all, which is why the following section is mosquitto specific. If you
need authorization, check with the broker that you want to use before you start
using it.</p>
<p>Mosquitto supports reading authorization rules from a file called <code>acl_file</code>.
This file contains a list of rules of the following form</p>
<pre><code>[pattern|topic] [read|write|readwrite|deny] [topic]
</code></pre>
<p><code>topic</code> rules can use the same wildcard characters as subscription patterns.
Rules on top of the file will be applied to anonymous clients. Rules can also be
applied to single username by prefixing a block of rules with a
<code>user &lt;username&gt;</code> line. <code>pattern</code>s on the other hand can contain two additional
wildcards <code>%s</code> and <code>%u</code>. <code>%s</code> is replaced by the session identifier of the
client, while <code>%u</code> is replaced with the username that is used in the connect
package. Patterns <strong>always</strong> apply to all clients.</p>
<p>To make sure that a user can only send messages with themselves as the sender,
and subscribe only to topics with themselves as the target, we need two rules</p>
<pre><code># Patterns affect all clients
# Allow clients to read their own messages
pattern read chat/messages/%u/+
# Allow clients to send messages to other
# clients, as long as they use themselves as
# the sender
pattern write chat/messages/+/%u
</code></pre>
<p>The topics for the status feature can be protected in the same way:</p>
<pre><code># Patterns affect all clients
# Allow clients to write their own status
pattern write chat/status/%u
# Allow all clients to read other people&#x27;s status
pattern read chat/status/+
</code></pre>
<p>To illustrate how to use special authorization rules for a single user, I&#x27;ve
added a rule that allows the admin user to read all messages for <em>compliance</em>
reasons:</p>
<pre><code># Allow the admin user to read all messages
user admin
topic read chat/messages/+/+
</code></pre>
<p>In the <a href="https://github.com/Staff-d/mqtt-chat">demo</a> application, authorization
and authentication can be enabled via the <code>use authentication</code> checkbox:
<a href="http://localhost:5173/?stage=40"><code>http://localhost:5173/?stage=40</code></a>. To be able
to enforce the authorization rules correctly, this switch actually redirects all
traffic to a second broker that has authentication enabled.</p>
<p>If we log in as the <code>admin</code> user (password: <code>admin</code>) we can now read the
messages of all users, while they can only read the messages which are addressed
to them:</p>
<video controls="" preload="metadata" muted="" loop="" class="w-full"><source src="/videos/stage-40-fast.webm" type="video/webm"/><p>Your browser does not support the video tag.</p></video>
<p>With this feature, our simple chat application is completed.</p>
<h2 id="limitations-and-how-to-overcome-them">Limitations and how to overcome them</h2>
<p>If you are now considering using MQTT in your own application, you should be
aware of a few common problems that arise in real-world applications that I did
not include in my demo application.</p>
<h3 id="ad-hoc-authorization">Ad Hoc authorization</h3>
<p>Mosquitto&#x27;s static, topic-based authorization works well if the topics are known
in advance, but falls short when the topics are created dynamically.</p>
<p>In our chat application, this problem arises when we want to implement chat
groups consisting of multiple participants that can be added and removed
dynamically. Let&#x27;s assume that we assign an id to every chat room and use a
topic of the form <code>chat/room/[room_id]</code> to distribute messages to the group.</p>
<p>As Mosquitto keeps the authorization rules in a file, we would need to update
this file and reload the configuration whenever the membership of a chat room
changes.</p>
<p>The Mosquitto ecosystem offers two plugins that solve this problem: The
<a href="https://mosquitto.org/documentation/dynamic-security/">dynamic security plugin</a>
offers an API via a magic MQTT topic to update the authorization rules at
runtime and introduces additional concepts such as roles and groups. These
rules, however, are stored in a JSON file and require other applications to use
MQTT as well or use the included cli application to update the rules.</p>
<p>Another option that is better suited for more complex applications is
<a href="https://github.com/iegomez/mosquitto-go-auth">mosquitto-go-auth</a> which offers
the option to store the authorization rules in a database like postgres, redis,
or mongoDB, which can be accessed and maintained by external applications.</p>
<h3 id="data-validation">Data Validation</h3>
<p>One of the most common issues that arise when implementing MQTT in a real-life,
user-facing application is the need to validate the messages that are sent to a
specific topic. This is something that a typical MQTT broker cannot do out of
the box, but there are common patterns to overcome this limitation.</p>
<p>Let&#x27;s stick with our chat example: Assume that we maintain a blacklist of
forbidden words that may not be sent via our application. Checking against this
list only on the frontend side would allow a user to connect to our broker via a
different MQTT client and send messages containing forbidden words anyways, so
this solution won&#x27;t cut it.</p>
<p>One Pattern that is, for example, employed by the
<a href="https://docs.aws.amazon.com/iot/latest/developerguide/device-shadow-mqtt.html#:r2j:">AWS IoT Core</a>,
is to split the single chat topic into multiple smaller ones:
<code>chat/[receiver]/[sender]/request</code> for message send requests,
<code>chat/[receiver]/[sender]/accepted</code> for messages that pass the blacklist check
and <code>chat/[receiver]/[sender]/rejected</code> for messages that don&#x27;t. We now need to
change the authorization rules as follows to allow message senders to publish
new chat messages only to the <code>/request</code> topic and subscribe to the <code>/rejected</code>
topic to receive feedback on their messages. Message receivers can subscribe to
the <code>/accepted</code> topic to receive only those messages that have passed the
blacklist check:</p>
<pre><code># Permissions for chat users
pattern read chat/messages/%u/+/accepted
pattern write chat/messages/+/%u/request
pattern write chat/messages/+/%u/rejected

# Permissions for the backend app
# that has to perform the blacklist check
user backend
topic read chat/messages/+/+/request
topic write chat/messages/+/+/accepted
topic write chat/messages/+/+/rejected
</code></pre>
<p>The check against the blacklist has to be performed by a custom-built worker,
authorized by the username <code>backend</code>, running on a server somewhere. This worker
subscribes to the <code>/request</code> topic and publishes the messages to the <code>/accepted</code>
or <code>/rejected</code> topic, depending on the result of the check against the
blacklist. It is important to note, however, that every message that is sent on
any chat topic now has to pass through this worker. This might not be a problem
when checking against a static blacklist, but depending on the complexity of the
check (which might contain calls to a datastore), might create a bottleneck in
our application.</p>
<h2 id="use-case-examples">Use Case Examples</h2>
<p>To conclude this article I wanted to present a few more applications that could
be implemented using MQTT, but didn&#x27;t make the cut to be selected for my demo
application:</p>
<h3 id="newsticker-app">Newsticker App</h3>
<p>Publishes new articles to a hierarchy of topics that represent the different
categories of the news, e.g. <code>news/politics/us/utah</code>,<code>news/politics/europe</code>,
<code>news/sport/football</code>, <code>news/sport/formula-1</code>. Clients can subscribe to the
categories that are most interesting to them either directly, or by using
wildcards like <code>news/sport/#</code> to get all sport news.</p>
<h3 id="progress-reporting">Progress Reporting</h3>
<p>Useful for long-running, asynchronous tasks that are performed by a worker. The
worker publishes progress updates as retained messages to a topic that is unique
to the task. This way, whenever a client subscribes to the progress topic, they
would get the newest progress update immediately as well as all future updates.</p>
<h3 id="real-time-online-auctions">Real Time Online Auctions</h3>
<p>Auctioneers can publish new items to a topic that is unique to the auction.
Clients can subscribe to the wildcard topic <code>auctions/#</code> to get all new items
that are up for auction. Bids could be placed by addressing the item topic
directly, e.g. <code>auctions/1234/bid</code>, but would have to be verified by using a
backend worker as described in the <a href="#data-validation">data validation chapter</a>
to make sure that the bid is higher than the current highest bid. Successful
bids would be published on the original auction topic as a retained message, so
that all clients that are interested in the item would get the newest bid
immediately.</p>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html">MQTT 3.1.1 Specification</a></li>
<li><a href="https://mosquitto.org/man/mosquitto-conf-5.html">Mosquitto Configuration Options</a></li>
<li><a href="https://www.hivemq.com/blog/mqtt-essentials-part-4-mqtt-publish-subscribe-unsubscribe/">HiveMQ MQTT Essentials Blog Series</a></li>
<li><a href="https://www.emqx.com/en/blog/category/mqtt-protocol">emqx MQTT Tutorial Series</a></li>
</ul>
<p>If you are interested in MQTT, you&#x27;ll quickly encounter MQTT5. This article uses
MQTT 3.1.1 features only, as the changes in MQTT5 are not relevant for the use
cases described here. If you want to learn more about MQTT5 and you already have
a firm grasp of what MQTT 3.1.1 can do, I recommend the
<a href="https://www.hivemq.com/mqtt/mqtt-5/">HiveMQ MQTT5 writeup</a>.</p>
<h2 id="about-the-header-image">About the header Image</h2>
<p>Created with OpenAIs GPT-4o on 2024-11-15. Prompt:</p>
<blockquote>
<p>Create an image of a cellular tower in a happy mood. Use a comic style. Do not
show the faces of people.</p>
</blockquote></div></article><section class="w-full py-12 md:py-24 lg:py-32 bg-gray-100 dark:bg-gray-800"><div class="container px-4 md:px-6 mx-auto"><h2 class="text-3xl font-bold tracking-tighter sm:text-5xl text-center mb-4 md:mb-6">More posts like this one</h2><div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"><div class="rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between"><div class="flex flex-col space-y-1.5 p-6"><h3 class="font-semibold leading-none tracking-tight">As a freelancer, I put my trust in NixOS. Here&#x27;s why.</h3><div class="flex items-center space-x-1 text-sm text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><time dateTime="2024-11-07T10:11:08.169Z">Nov 7, 2024, 11:11 AM</time></div></div><div class="p-6 pt-0"><p>In today&#x27;s blog I want to talk about why I have chosen NixOS as my main operating system.</p></div><div class="items-center p-6 pt-0 flex justify-between"><p class="text-sm text-gray-500">By <!-- -->Sebastian Staffa</p><a href="/posts/nixos-as-a-freelancer"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2">Read More<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right ml-2 h-4 w-4"><path d="m9 18 6-6-6-6"></path></svg></button></a></div></div><div class="rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between"><div class="flex flex-col space-y-1.5 p-6"><h3 class="font-semibold leading-none tracking-tight">On How To Lead Devs</h3><div class="flex items-center space-x-1 text-sm text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><time dateTime="2024-03-25T15:58:07.801Z">Mar 25, 2024, 4:58 PM</time></div></div><div class="p-6 pt-0"><p>After I have been entrusted with leadership responsibilities, it&#x27;s time to reflect on how not to mess it up.</p></div><div class="items-center p-6 pt-0 flex justify-between"><p class="text-sm text-gray-500">By <!-- -->Sebastian Staffa</p><a href="/posts/on-how-to-lead-devs"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2">Read More<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right ml-2 h-4 w-4"><path d="m9 18 6-6-6-6"></path></svg></button></a></div></div><div class="rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between"><div class="flex flex-col space-y-1.5 p-6"><h3 class="font-semibold leading-none tracking-tight">Azure revisited</h3><div class="flex items-center space-x-1 text-sm text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><time dateTime="2022-11-21T12:13:08.801Z">Nov 21, 2022, 1:13 PM</time></div></div><div class="p-6 pt-0"><p>A year with Azure has passed, and this is what I have learned.</p></div><div class="items-center p-6 pt-0 flex justify-between"><p class="text-sm text-gray-500">By <!-- -->Sebastian Staffa</p><a href="/posts/azure-revisited"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2">Read More<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right ml-2 h-4 w-4"><path d="m9 18 6-6-6-6"></path></svg></button></a></div></div></div></div></section></main><footer class="flex flex-col gap-2 sm:flex-row py-6 w-full shrink-0 items-center px-4 md:px-6 border-t"><p class="text-xs text-gray-500 dark:text-gray-400">© <!-- -->2024<!-- --> Sebastian Staffa.</p><nav class="sm:ml-auto flex gap-4 sm:gap-6"><a class="text-xs hover:underline underline-offset-4" href="/feed.rss">RSS</a><a class="text-xs hover:underline underline-offset-4" href="/imprint">Imprint</a></nav></footer></div><script src="/_next/static/chunks/webpack-9928534fc2156327.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"3:\"$Sreact.fragment\"\n4:I[231,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"884\",\"static/chunks/884-c50d8beb1ec70a5a.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-ff0103dd57687992.js\"],\"\"]\n5:I[9275,[],\"\"]\n6:I[1343,[],\"\"]\n7:I[5361,[\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"185\",\"static/chunks/app/layout-d8addcc19b69e0c2.js\"],\"default\",1]\n9:I[3120,[],\"OutletBoundary\"]\nb:I[3120,[],\"MetadataBoundary\"]\nd:I[3120,[],\"ViewportBoundary\"]\nf:I[6130,[],\"\"]\n1:HL[\"/_next/static/media/d4834662e8b5d3f9-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n2:HL[\"/_next/static/css/f02cf5e1e4530fa1.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ZQAu3EeuN4FPrH4aCfOCN\",\"p\":\"\",\"c\":[\"\",\"posts\",\"mqtt-for-webdevs\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"mqtt-for-webdevs\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"mqtt-for-webdevs\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$3\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f02cf5e1e4530fa1.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__variable_4eb141\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col min-h-screen\",\"children\":[[\"$\",\"header\",null,{\"className\":\"px-4 lg:px-6 h-14 flex items-center\",\"children\":[[\"$\",\"$L4\",null,{\"className\":\"flex items-center justify-center\",\"href\":\"/\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-book-open h-6 w-6\",\"children\":[[\"$\",\"path\",\"1akyts\",{\"d\":\"M12 7v14\"}],[\"$\",\"path\",\"ruj8y\",{\"d\":\"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"Acme Blog\"}]]}],[\"$\",\"nav\",null,{\"className\":\"ml-auto flex gap-4 sm:gap-6\",\"children\":[[\"$\",\"$L4\",null,{\"className\":\"text-sm font-medium hover:underline underline-offset-4\",\"href\":\"/\",\"children\":\"Home\"}],[\"$\",\"$L4\",null,{\"className\":\"text-sm font-medium hover:underline underline-offset-4\",\"href\":\"/contact\",\"children\":\"Contact\"}],[\"$\",\"$L4\",null,{\"className\":\"text-sm font-medium hover:underline underline-offset-4\",\"href\":\"/posts\",\"children\":\"Blog\"}]]}]]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}],[\"$\",\"$L7\",null,{}],[\"$\",\"footer\",null,{\"className\":\"flex flex-col gap-2 sm:flex-row py-6 w-full shrink-0 items-center px-4 md:px-6 border-t\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-xs text-gray-500 dark:text-gray-400\",\"children\":[\"© \",2024,\" Sebastian Staffa.\"]}],[\"$\",\"nav\",null,{\"className\":\"sm:ml-auto flex gap-4 sm:gap-6\",\"children\":[[\"$\",\"$L4\",null,{\"className\":\"text-xs hover:underline underline-offset-4\",\"href\":\"/feed.rss\",\"prefetch\":false,\"children\":\"RSS\"}],[\"$\",\"$L4\",null,{\"className\":\"text-xs hover:underline underline-offset-4\",\"href\":\"/imprint\",\"children\":\"Imprint\"}]]}]]}]]}]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"mqtt-for-webdevs\",\"d\"],[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$3\",\"c\",{\"children\":[\"$L8\",null,[\"$\",\"$L9\",null,{\"children\":\"$La\"}]]}],{},null]},null]},null]},null],[\"$\",\"$3\",\"h\",{\"children\":[null,[\"$\",\"$3\",\"u5lLTuNEZhHAcOaWFmSzB\",{\"children\":[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":\"$f\",\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:I[3421,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"884\",\"static/chunks/884-c50d8beb1ec70a5a.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-ff0103dd57687992.js\"],\"Avatar\",1]\n11:I[3421,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"884\",\"static/chunks/884-c50d8beb1ec70a5a.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-ff0103dd57687992.js\"],\"AvatarImage\",1]\n12:I[3421,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"884\",\"static/chunks/884-c50d8beb1ec70a5a.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-ff0103dd57687992.js\"],\"AvatarFallback\",1]\n13:I[8173,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"884\",\"static/chunks/884-c50d8beb1ec70a5a.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-ff0103dd57687992.js\"],\"Image\"]\n14:I[5025,[\"173\",\"static/chunks/173-ffd0b8113e523dc5.js\",\"536\",\"static/chunks/536-d4fee2fe7c6d19de.js\",\"884\",\"static/chunks/884-c50d8beb1ec70a5a.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-ff0103dd57687992.js\"],\"PreloadChunks\"]\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"suppressHydrationWarning\":true,\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"MQTT For Web Developers\\\",\\\"datePublished\\\":\\\"2024-11-20T16:13:52.889Z\\\",\\\"dateModified\\\":\\\"2024-11-20T16:13:52.889Z\\\",\\\"description\\\":\\\"MQTT is a protocol that is typically used in an IoT context. In this article, we'll explore how we could use its capabilities in a traditional web application to stream messages in real-time.\\\",\\\"image\\\":\\\"https://sebastian-staffa.eu/images/happy-mqtt-big.webp\\\",\\\"url\\\":\\\"https://sebastian-staffa.eu/posts/mqtt-for-webdevs\\\",\\\"author\\\":{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Sebastian Staffa\\\"}}\"}}],[\"$\",\"article\",null,{\"className\":\"container max-w-3xl px-4 py-6 lg:py-12 mx-auto\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl lg:text-6xl/none mb-4\",\"children\":\"MQTT For Web Developers\"}],\"$undefined\",[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4 mb-4\",\"children\":[[\"$\",\"$L10\",null,{\"children\":[[\"$\",\"$L11\",null,{\"src\":\"/_next/static/media/portrait-ico.778fd454.webp\",\"alt\":\"Avatar of Sebastian Staffa\"}],[\"$\",\"$L12\",null,{\"children\":\"S\"}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm font-medium\",\"children\":\"Sebastian Staffa\"}],[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500 flex flex-row align-baseline\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar inline-block w-4 h-4 mr-1\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],\"Published on\",\" \",\"Nov 20, 2024, 5:13 PM\"]}]]}]]}],[\"$\",\"$L13\",null,{\"src\":{\"src\":\"/_next/static/media/happy-mqtt-big.a9198661.webp\",\"height\":1024,\"width\":2048,\"blurDataURL\":\"data:image/webp;base64,UklGRkIAAABXRUJQVlA4IDYAAADQAQCdASoIAAQAAkA4JZgCdAEO/gOOAAD+6zB/763E6gXPZBpTXmX+VpcRm117+XWXkeyJQAA=\",\"blurWidth\":8,\"blurHeight\":4},\"alt\":\"An illustration of a happy cellular tower, generated by OpenAI's GPT-4o\",\"className\":\"rounded-lg object-cover w-full mb-8\",\"priority\":true}],[\"$\",\"div\",null,{\"className\":\"prose max-w-none\",\"children\":[[\"$\",\"$L14\",null,{\"moduleIds\":\"$undefined\"}],\"$L15\"]}]]}],\"$L16\"]}]\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"h2\",null,{\"id\":\"what-is-this-about\",\"children\":\"What is this about?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"During this year's \",[\"$\",\"a\",null,{\"href\":\"https://www.unkonf.de\",\"children\":\"unKonf\"}],\", an\\n\",[\"$\",\"a\",null,{\"href\":\"https://en.wikipedia.org/wiki/Unconference\",\"children\":\"unconference\"}],\" taking place in the\\nGerman city of Mannheim, I prepared a quick talk about MQTT and how it could be\\nused in web applications. This article is a written, improved version of this\\ntalk, taking into account all the feedback that I received.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The Message Queuing Telemetry Transport protocol, or MQTT for short, is a\\nprotocol that delivers messages between clients via a central broker. It was\\ninitially designed for low-bandwidth, high-latency networks (like cellular) to\\nbe used directly on top of TCP, and optimized for clients with low storage and\\ncomputing capabilities (like embedded devices) but can also be used on top of\\nWebsockets. This enables us to use MQTT in traditional web applications.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This article will focus on exactly that by designing a chat application using\\nMQTT 3.1.1 as a practical example. I've also implemented this app using\\n\",[\"$\",\"a\",null,{\"href\":\"https://www.npmjs.com/package/mqtt\",\"children\":\"mqtt.js\"}],\", \",[\"$\",\"a\",null,{\"href\":\"https://react.dev/\",\"children\":\"react\"}],\",\\n\",[\"$\",\"a\",null,{\"href\":\"https://ui.shadcn.com/\",\"children\":\"shadcn\"}],\", \",[\"$\",\"a\",null,{\"href\":\"https://tailwindcss.com/\",\"children\":\"tailwind\"}],\" and the\\n\",[\"$\",\"a\",null,{\"href\":\"https://redux-toolkit.js.org/\",\"children\":\"redux-toolkit\"}],\" to build the frontend and\\n\",[\"$\",\"a\",null,{\"href\":\"https://mosquitto.org/\",\"children\":\"mosquitto\"}],\" as the MQTT broker. You can check out the\\nrepository \",[\"$\",\"a\",null,{\"href\":\"https://github.com/Staff-d/mqtt-chat\",\"children\":\"here\"}],\" if you want to play\\nalong, but I have also included screen recordings of the app at the end of every\\nchapter.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"why-should-you-care\",\"children\":\"Why should you care?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"MQTT comes with many features that allow its users to build robust and scalable\\nmessaging systems without writing any backend code. Features provided by the\\nprotocol include the ability for clients to selectively choose messages relevant\\nto them at any given time and the option to define a measure of importance for\\neach message, controlling how hard all participants should try to deliver it.\\nThe websocket operation mode allows us to integrate it directly into web\\napplications, making it ideal for building systems that display various types of\\nreal-time information from multiple sources to many clients simultaneously.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"mqtt-basics\",\"children\":\"MQTT Basics\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"MQTT governs the communication between message senders, a central broker that\\ndistributes these messages, and message receivers. There are no direct\\nconnections between MQTT clients: Every message is proxied via the broker.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Every MQTT connection starts with a \",[\"$\",\"code\",null,{\"children\":\"connect\"}],\" handshake between a client and the\\nbroker. The simplest form of this handshake does not contain much besides a\\nsession identifier to identify the running session.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"After a connection is established, the server periodically sends pings to the\\nclient to determine whether the client is still alive. The interval in which\\nthese pings are sent can be configured by the client with the \",[\"$\",\"code\",null,{\"children\":\"connect\"}],\" package.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"sending-and-receiving-messages\",\"children\":\"Sending And Receiving Messages\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When clients want to send a message, they can send a \",[\"$\",\"code\",null,{\"children\":\"publish\"}],\" package to the\\nbroker. This package contains the message payload and is addressed to a topic.\\nTopics are hierarchical strings and, similar to a file path, separated by\\nslashes, e.g. \",[\"$\",\"code\",null,{\"children\":\"room/hallway/temperature\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The message is then forwarded by the broker to all clients that are subscribed\\nto this topic. A client subscribes to a topic by sending a \",[\"$\",\"code\",null,{\"children\":\"subscribe\"}],\" message\\nto the broker that either contains a topic or a topic pattern. A topic pattern\\ncan contain two different kinds of wildcard characters: \",[\"$\",\"code\",null,{\"children\":\"+\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"#\"}],\". The \",[\"$\",\"code\",null,{\"children\":\"+\"}],\"\\ncharacter matches exactly one level of the topic hierarchy and can be used\\nmultiple times, while the \",[\"$\",\"code\",null,{\"children\":\"#\"}],\" character matches any number of levels and must be\\nthe last character of a pattern string. Both wildcards can only match a complete\\nlevel of the topic hierarchy, which means that \",[\"$\",\"code\",null,{\"children\":\"room/hall+\"}],\" would be an invalid\\npattern. The following subscription patterns would match the message sent to the\\ntopic \",[\"$\",\"code\",null,{\"children\":\"room/hallway/temperature\"}],\":\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"// Examples of VALID patterns that match room/hallway/temperature\\n// Complete topic\\nroom/hallway/temperature\\n// One single level wildcard\\nroom/hallway/+\\n// One single level wildcard that matches every temperature topic\\nroom/+/temperature\\n// Two single level wildcards that match every message in every room\\nroom/+/+\\n// Three single level wildcards that match every message sent on the broker\\n// with three hierarchy levels\\n+/+/+\\n// Multilevel wildcard for all topics that start with room/\\nroom/#\\n// The single multilevel wildcard matches all topics on a broker\\n#\\n\\n// Examples of INVALID patterns\\n// A multilevel wildcard is not last character of the pattern\\nroom/#/temperature\\n// Multiple multilevel wildcards are not allowed\\nroom/#/#\\n// Wildcards can only be used to match complete levels\\nroom/hall+/temperature\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"With these three building blocks (a session identifier, the publish and\\nsubscribe commands) we can build a simple chat application. This application\\nwould work as follows:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"A user can choose any username, which the application will use as the MQTT\\nsession identifier (this will be important later)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"By convention, a user can send messages to any other user by publishing a\\nmessage to the topic \",[\"$\",\"code\",null,{\"children\":\"chat/messages/[receiver]/[sender]\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"To receive messages, a user subscribes to the topic\\n\",[\"$\",\"code\",null,{\"children\":\"chat/messages/[username]/+\"}],\" to get all the messages that are addressed to\\nthemselves.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you are running the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/Staff-d/mqtt-chat\",\"children\":\"demo\"}],\" application,\\nyou can try out this first implementation of our chat app by navigating to\\n\",[\"$\",\"a\",null,{\"href\":\"http://localhost:5173/?stage=10\",\"children\":[\"$\",\"code\",null,{\"children\":\"http://localhost:5173/?stage=10\"}]}],\" and\\nentering any name to login and start chatting.\"]}],\"\\n\",[\"$\",\"video\",null,{\"controls\":true,\"preload\":\"metadata\",\"muted\":true,\"loop\":true,\"className\":\"w-full\",\"children\":[[\"$\",\"source\",null,{\"src\":\"/videos/stage-10-fast.webm\",\"type\":\"video/webm\"}],[\"$\",\"p\",null,{\"children\":\"Your browser does not support the video tag.\"}]]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"quality-of-service-qos\",\"children\":\"Quality of Service (QoS)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When a message is published to a MQTT topic, the sender can specify a Quality of\\nService (QoS) level. When a client subscribes to a topic, a QoS value can also\\nbe specified which determines the maximum QoS level that is delivered to this\\nsubscription. Colloquially speaking, the QoS value determines how hard the MQTT\\nbroker should try to deliver the message: the higher the QoS, the harder the\\nbroker tries. If the QoS level of a subscription is lower than the QoS level of\\na message that should be sent to a subscription, the broker downgrades the QoS\\nof the message to match the one of the subscription.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Before we take a look at the different QoS levels, it is important to talk about\\nthe definition of \\\"delivering\\\" a message. In the MQTT-sense, a message is\\nconsidered to be delivered when the sender has tried its best to send the\\nmessage (in the case of QoS0) or after the package has been acknowledged via\\nsome kind of \",[\"$\",\"code\",null,{\"children\":\"ack\"}],\" packet (in the case of QoS1/2). As both of these actions\\noccur before the data is passed to the receiving application, MQTT cannot manage\\nmessage \",[\"$\",\"strong\",null,{\"children\":\"processing\"}],\". If the client crashes immediately after receiving the\\nmessage, the message is still considered delivered. This is different from other\\nmessage queuing systems, such as RabbitMQ, where messages can be redelivered if\\nthe processing of the message failed.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"qos-0-deliver-at-most-once\",\"children\":\"QoS 0: Deliver At Most Once\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"QoS 0 is the default value for many MQTT clients when publishing a message. On\\nthis level, the message is delivered in a best effort fashion, but both the\\nclient and broker can to drop the message if they cannot deliver it on the first\\ntry for any reason. Typical cases when messages are dropped are when the client\\nis offline, the network is congested or the broker is overloaded.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In our chat application we could use QoS 0 for informational messages, like the\\ninformation about when a user comes online or goes offline. We won't implement\\nthis right away, but keep this in mind for later.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"qos-1-deliver-at-least-once\",\"children\":\"QoS 1: Deliver At Least Once\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"At QoS 1, the published message is delivered at least once, but may be delivered\\nmultiple times. At this level, many client libraries implement a message queue\\nto keep track of the messages that have not yet been acknowledged by the broker.\\nBrokers now require a client to send an \",[\"$\",\"code\",null,{\"children\":\"puback\"}],\" package to confirm that it has\\nsuccessfully received the package. They also start to keep track of which\\nmessages have been delivered to which sessions based on the session identifier,\\nso that they can resend the message if a client is not online when a new message\\nis published.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"It is important to note that, even though it is widely supported, this feature\\nof storing messages for offline clients (called session persistence) is not\\nrequired for a MQTT-compliant broker. The\\n\",[\"$\",\"a\",null,{\"href\":\"http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Storing_state\",\"children\":\"section 4.1 of the standard states\"}],\"\\nthat\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"The Client and Server MUST store Session state for the entire duration of the\\nSession. A Session MUST last at least as long it has an active Network\\nConnection.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Until now, our chat application had the problem that messages can only be\\ndelivered when the receiver is online. By using session persistence and QoS 1\\nmessages we can make sure that every chat message arrives at the receiver at\\nleast once. On the other hand we don't care about redeliveries, because we can\\neasily deduplicate the message on the client side, so we don't need QoS 2 (see\\nbelow).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you are running the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/Staff-d/mqtt-chat\",\"children\":\"demo\"}],\" application,\\nyou can try out this improved implementation of our chat app by navigating to\\n\",[\"$\",\"a\",null,{\"href\":\"http://localhost:5173/?stage=20\",\"children\":[\"$\",\"code\",null,{\"children\":\"http://localhost:5173/?stage=20\"}]}],\" or check\\nthe \",[\"$\",\"code\",null,{\"children\":\"Use QoS 1\"}],\" checkbox. You can still enter any name to login, but whenever\\nyou close a chat window and login again, you will receive all the messages that\\nhave been sent to you while you were offline.\"]}],\"\\n\",[\"$\",\"video\",null,{\"controls\":true,\"preload\":\"metadata\",\"muted\":true,\"loop\":true,\"className\":\"w-full\",\"children\":[[\"$\",\"source\",null,{\"src\":\"/videos/stage-20-fast.webm\",\"type\":\"video/webm\"}],[\"$\",\"p\",null,{\"children\":\"Your browser does not support the video tag.\"}]]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"qos-2-deliver-exactly-once\",\"children\":\"QoS 2: Deliver Exactly Once\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"QoS 2 is the strictest of the three QoS levels. At this level, each message is\\ndelivered exactly once to every receiver. This is asserted by a two-way\\nhandshake that is performed whenever a message is delivered.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This quality level is not implemented by many brokers because it is the most\\nexpensive in terms of state management. For many MQTT use cases, it also not\\nthat useful because the use case can often be modeled with QoS 1 messages and\\nclient-side deduplication.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"retained-messages\",\"children\":\"Retained Messages\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"While publishing a message, a client can specify an additional parameter besides\\nthe topic, payload and QoS: the retain flag. If this feature is enabled on the\\nbroker and the retain flag is set, the message is stored on the given topic.\\nThis means that every client that subscribes to this topic will receive the last\\nretained message that has been sent to this topic.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It is important to note that retained messages are kept independently of the\\nsessions state of the sender, meaning that retained messages are kept even is\\nsession state is discarded.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In our chat application, we can use retained messages to display the\\nonline/offline status of a user. Whenever our client application connects to the\\nbroker successfully, we send a message of the following form on the topic\\n\",[\"$\",\"code\",null,{\"children\":\"chat/status/[username]\"}],\" using \",[\"$\",\"strong\",null,{\"children\":\"QoS 0\"}],\" and the retain flag set:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-javascript\",\"children\":\"{\\n    status: \\\"online\\\",\\n    lastOnlineTimestamp: DateTime.now().toISO(),\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Whenever a user wants to disconnect by clicking the logout button, we switch our\\nstatus to offline by publishing:\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-javascript\",\"children\":\"{\\n    status: \\\"offline\\\",\\n    lastOnlineTimestamp: DateTime.now().toISO(),\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Now, whenever a client subscribes to the topic \",[\"$\",\"code\",null,{\"children\":\"chat/status/+\"}],\", they will\\nreceive the last status update of every client that is registered with the\\nserver. As we only care for the newest status information, we choose QoS 0 for\\nthe status messages. With a higher QoS the broker would queue the message for\\ndelivery for clients that are offline, which would then receive a boatload of\\noutdated status updates when they reconnect. QoS 0 guarantees that older status\\nupdates are discarded when a subscriber is offline, and only the newest status\\nupdate is delivered when they resubscribe.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"last-will-and-testament-lwt\",\"children\":\"Last Will And Testament (LWT)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A MQTT client can specify a last will as a part of the \",[\"$\",\"code\",null,{\"children\":\"connect\"}],\" packet when\\nconnecting to the broker. This feature allows a client to request the broker to\\nsend one final message should the connection between the two be interrupted\\nunexpectedly, for example by a client that crashes or a network outage. A last\\nwill consists of everything that is needed to send a normal message: a topic, a\\npayload, a QoS level and the retain flag.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"However, it is important to note that the LWT only triggers during abnormal\\ndisconnects. If a client disconnects in a graceful manner, the LWT will not be\\nsent.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In our chat application we can use the LWT to make our status feature more\\nrobust. Currently, we cannot send a status update to set the status of a user to\\n\",[\"$\",\"code\",null,{\"children\":\"offline\"}],\" when a user just closes the browser tab. With LWT, we can fix this\\nissue: during connection to the broker, we specify that an \",[\"$\",\"code\",null,{\"children\":\"offline\"}],\" status\\nupdate should be sent to the status topic, with the same parameters (QoS,\\nretain) as we would use for a normal status update:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript\",\"children\":\"let will: IClientOptions[\\\"will\\\"] | undefined = undefined\\n// ...\\nconst willMessage: WireStatusMessage = {\\n  status: \\\"offline\\\",\\n  lastOnlineTimestamp: DateTime.now().toISO(),\\n}\\n\\nwill = {\\n  topic: `chat/status/${action.payload.credentials.username}`,\\n  payload: Buffer.from(JSON.stringify(willMessage)),\\n  qos: 0,\\n  retain: true,\\n}\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The downside of this approach is that we cannot update the timestamp in the\\nstatus message, as the LWT cannot be updated after it was initially set without\\ndisconnecting and reconnecting to the broker.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"a\",null,{\"href\":\"https://github.com/Staff-d/mqtt-chat\",\"children\":\"demo\"}],\" application provides this\\nfeature set with the toggle \",[\"$\",\"code\",null,{\"children\":\"use status messages\"}],\", available via\\n\",[\"$\",\"a\",null,{\"href\":\"http://localhost:5173/?stage=30\",\"children\":[\"$\",\"code\",null,{\"children\":\"http://localhost:5173/?stage=30\"}]}],\". Every chat\\nshould now display a status badge next to the name of the chat participant that\\nupdates whenever a user logs in or out of the app.\"]}],\"\\n\",[\"$\",\"video\",null,{\"controls\":true,\"preload\":\"metadata\",\"muted\":true,\"loop\":true,\"className\":\"w-full\",\"children\":[[\"$\",\"source\",null,{\"src\":\"/videos/stage-30-fast.webm\",\"type\":\"video/webm\"}],[\"$\",\"p\",null,{\"children\":\"Your browser does not support the video tag.\"}]]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"authentication\",\"children\":\"Authentication\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In the MQTT ecosystem, two kinds of authentication are in widespread use:\\nPassword-based and certificate-based authentication.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first one is defined in the MQTT standard: In the initial connect package,\\nthe client can include a password and a username. The problem with this approach\\nis that both username and password are sent in plaintext, which becomes a\\nsecurity liability if as the transport layer is unencrypted too.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The second option, which is not standardized but de-facto supported on almost\\nevery broker, is to use client-certificates. This approach uses a feature of the\\nTLS protocol (so it is only available if MQTT is running on top of TLS, in which\\ncase it is often called MQTTS), that requires the TLS client to present a\\n\",[\"$\",\"a\",null,{\"href\":\"https://en.wikipedia.org/wiki/Transport_Layer_Security#Client-authenticated_TLS_handshake\",\"children\":\"certificate during the TLS handshake\"}],\".\\nClient certificates are more difficult to set up initially, but can save a lot\\nof headache further down the line for two reasons. First, the TLS handshake uses\\na challenge mechanism to verify the client certificate, which means that no\\nconfidential data is exchanged in plaintext. Second, using client certificates\\nrelieves the broker operator from the burden of maintaining the list of\\nusername/password pairs at the MQTT broker or, especially in the web application\\ncontext where user information might be kept in an external database, from\\nsynchronizing it with external data sources. Instead of checking the identity of\\neach certificate individually, the broker can use the certificate's chain of\\ntrust to verify the validity of the certificate by checking it against the\\npublic key of a root certificate that was used to sign the client certificate.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"authorization\",\"children\":\"Authorization\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Until now, a client could just send messages to any MQTT topic, which means that\\nthey could easily impersonate another user. With authentication in place, we can\\nnow ensure that users can only send messages with themselves as the sender by\\ndefining authorization rules.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Unfortunately, authorization is not part of the MQTT standard. As stated by\\nsection\\n\",[\"$\",\"a\",null,{\"href\":\"http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc385349387\",\"children\":\"5.4.2 of the standard\"}]]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"An implementation may restrict access to Server resources based on information\\nprovided by the Client\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"That's all, which is why the following section is mosquitto specific. If you\\nneed authorization, check with the broker that you want to use before you start\\nusing it.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Mosquitto supports reading authorization rules from a file called \",[\"$\",\"code\",null,{\"children\":\"acl_file\"}],\".\\nThis file contains a list of rules of the following form\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"[pattern|topic] [read|write|readwrite|deny] [topic]\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"topic\"}],\" rules can use the same wildcard characters as subscription patterns.\\nRules on top of the file will be applied to anonymous clients. Rules can also be\\napplied to single username by prefixing a block of rules with a\\n\",[\"$\",\"code\",null,{\"children\":\"user \u003cusername\u003e\"}],\" line. \",[\"$\",\"code\",null,{\"children\":\"pattern\"}],\"s on the other hand can contain two additional\\nwildcards \",[\"$\",\"code\",null,{\"children\":\"%s\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"%u\"}],\". \",[\"$\",\"code\",null,{\"children\":\"%s\"}],\" is replaced by the session identifier of the\\nclient, while \",[\"$\",\"code\",null,{\"children\":\"%u\"}],\" is replaced with the username that is used in the connect\\npackage. Patterns \",[\"$\",\"strong\",null,{\"children\":\"always\"}],\" apply to all clients.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To make sure that a user can only send messages with themselves as the sender,\\nand subscribe only to topics with themselves as the target, we need two rules\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"# Patterns affect all clients\\n# Allow clients to read their own messages\\npattern read chat/messages/%u/+\\n# Allow clients to send messages to other\\n# clients, as long as they use themselves as\\n# the sender\\npattern write chat/messages/+/%u\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The topics for the status feature can be protected in the same way:\"}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"# Patterns affect all clients\\n# Allow clients to write their own status\\npattern write chat/status/%u\\n# Allow all clients to read other people's status\\npattern read chat/status/+\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"To illustrate how to use special authorization rules for a single user, I've\\nadded a rule that allows the admin user to read all messages for \",[\"$\",\"em\",null,{\"children\":\"compliance\"}],\"\\nreasons:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"# Allow the admin user to read all messages\\nuser admin\\ntopic read chat/messages/+/+\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/Staff-d/mqtt-chat\",\"children\":\"demo\"}],\" application, authorization\\nand authentication can be enabled via the \",[\"$\",\"code\",null,{\"children\":\"use authentication\"}],\" checkbox:\\n\",[\"$\",\"a\",null,{\"href\":\"http://localhost:5173/?stage=40\",\"children\":[\"$\",\"code\",null,{\"children\":\"http://localhost:5173/?stage=40\"}]}],\". To be able\\nto enforce the authorization rules correctly, this switch actually redirects all\\ntraffic to a second broker that has authentication enabled.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If we log in as the \",[\"$\",\"code\",null,{\"children\":\"admin\"}],\" user (password: \",[\"$\",\"code\",null,{\"children\":\"admin\"}],\") we can now read the\\nmessages of all users, while they can only read the messages which are addressed\\nto them:\"]}],\"\\n\",[\"$\",\"video\",null,{\"controls\":true,\"preload\":\"metadata\",\"muted\":true,\"loop\":true,\"className\":\"w-full\",\"children\":[[\"$\",\"source\",null,{\"src\":\"/videos/stage-40-fast.webm\",\"type\":\"video/webm\"}],[\"$\",\"p\",null,{\"children\":\"Your browser does not support the video tag.\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"With this feature, our simple chat application is completed.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"limitations-and-how-to-overcome-them\",\"children\":\"Limitations and how to overcome them\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If you are now considering using MQTT in your own application, you should be\\naware of a few common problems that arise in real-world applications that I did\\nnot include in my demo application.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"ad-hoc-authorization\",\"children\":\"Ad Hoc authorization\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Mosquitto's static, topic-based authorization works well if the topics are known\\nin advance, but falls short when the topics are created dynamically.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In our chat application, this problem arises when we want to implement chat\\ngroups consisting of multiple participants that can be added and removed\\ndynamically. Let's assume that we assign an id to every chat room and use a\\ntopic of the form \",[\"$\",\"code\",null,{\"children\":\"chat/room/[room_id]\"}],\" to distribute messages to the group.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As Mosquitto keeps the authorization rules in a file, we would need to update\\nthis file and reload the configuration whenever the membership of a chat room\\nchanges.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The Mosquitto ecosystem offers two plugins that solve this problem: The\\n\",[\"$\",\"a\",null,{\"href\":\"https://mosquitto.org/documentation/dynamic-security/\",\"children\":\"dynamic security plugin\"}],\"\\noffers an API via a magic MQTT topic to update the authorization rules at\\nruntime and introduces additional concepts such as roles and groups. These\\nrules, however, are stored in a JSON file and require other applications to use\\nMQTT as well or use the included cli application to update the rules.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Another option that is better suited for more complex applications is\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/iegomez/mosquitto-go-auth\",\"children\":\"mosquitto-go-auth\"}],\" which offers\\nthe option to store the authorization rules in a database like postgres, redis,\\nor mongoDB, which can be accessed and maintained by external applications.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"data-validation\",\"children\":\"Data Validation\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"One of the most common issues that arise when implementing MQTT in a real-life,\\nuser-facing application is the need to validate the messages that are sent to a\\nspecific topic. This is something that a typical MQTT broker cannot do out of\\nthe box, but there are common patterns to overcome this limitation.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Let's stick with our chat example: Assume that we maintain a blacklist of\\nforbidden words that may not be sent via our application. Checking against this\\nlist only on the frontend side would allow a user to connect to our broker via a\\ndifferent MQTT client and send messages containing forbidden words anyways, so\\nthis solution won't cut it.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"One Pattern that is, for example, employed by the\\n\",[\"$\",\"a\",null,{\"href\":\"https://docs.aws.amazon.com/iot/latest/developerguide/device-shadow-mqtt.html#:r2j:\",\"children\":\"AWS IoT Core\"}],\",\\nis to split the single chat topic into multiple smaller ones:\\n\",[\"$\",\"code\",null,{\"children\":\"chat/[receiver]/[sender]/request\"}],\" for message send requests,\\n\",[\"$\",\"code\",null,{\"children\":\"chat/[receiver]/[sender]/accepted\"}],\" for messages that pass the blacklist check\\nand \",[\"$\",\"code\",null,{\"children\":\"chat/[receiver]/[sender]/rejected\"}],\" for messages that don't. We now need to\\nchange the authorization rules as follows to allow message senders to publish\\nnew chat messages only to the \",[\"$\",\"code\",null,{\"children\":\"/request\"}],\" topic and subscribe to the \",[\"$\",\"code\",null,{\"children\":\"/rejected\"}],\"\\ntopic to receive feedback on their messages. Message receivers can subscribe to\\nthe \",[\"$\",\"code\",null,{\"children\":\"/accepted\"}],\" topic to receive only those messages that have passed the\\nblacklist check:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"# Permissions for chat users\\npattern read chat/messages/%u/+/accepted\\npattern write chat/messages/+/%u/request\\npattern write chat/messages/+/%u/rejected\\n\\n# Permissions for the backend app\\n# that has to perform the blacklist check\\nuser backend\\ntopic read chat/messages/+/+/request\\ntopic write chat/messages/+/+/accepted\\ntopic write chat/messages/+/+/rejected\\n\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The check against the blacklist has to be performed by a custom-built worker,\\nauthorized by the username \",[\"$\",\"code\",null,{\"children\":\"backend\"}],\", running on a server somewhere. This worker\\nsubscribes to the \",[\"$\",\"code\",null,{\"children\":\"/request\"}],\" topic and publishes the messages to the \",[\"$\",\"code\",null,{\"children\":\"/accepted\"}],\"\\nor \",[\"$\",\"code\",null,{\"children\":\"/rejected\"}],\" topic, depending on the result of the check against the\\nblacklist. It is important to note, however, that every message that is sent on\\nany chat topic now has to pass through this worker. This might not be a problem\\nwhen checking against a static blacklist, but depending on the complexity of the\\ncheck (which might contain calls to a datastore), might create a bottleneck in\\nour application.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"use-case-examples\",\"children\":\"Use Case Examples\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To conclude this article I wanted to present a few more applications that could\\nbe implemented using MQTT, but didn't make the cut to be selected for my demo\\napplication:\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"newsticker-app\",\"children\":\"Newsticker App\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Publishes new articles to a hierarchy of topics that represent the different\\ncategories of the news, e.g. \",[\"$\",\"code\",null,{\"children\":\"news/politics/us/utah\"}],\",\",[\"$\",\"code\",null,{\"children\":\"news/politics/europe\"}],\",\\n\",[\"$\",\"code\",null,{\"children\":\"news/sport/football\"}],\", \",[\"$\",\"code\",null,{\"children\":\"news/sport/formula-1\"}],\". Clients can subscribe to the\\ncategories that are most interesting to them either directly, or by using\\nwildcards like \",[\"$\",\"code\",null,{\"children\":\"news/sport/#\"}],\" to get all sport news.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"progress-reporting\",\"children\":\"Progress Reporting\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Useful for long-running, asynchronous tasks that are performed by a worker. The\\nworker publishes progress updates as retained messages to a topic that is unique\\nto the task. This way, whenever a client subscribes to the progress topic, they\\nwould get the newest progress update immediately as well as all future updates.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"real-time-online-auctions\",\"children\":\"Real Time Online Auctions\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Auctioneers can publish new items to a topic that is unique to the auction.\\nClients can subscribe to the wildcard topic \",[\"$\",\"code\",null,{\"children\":\"auctions/#\"}],\" to get all new items\\nthat are up for auction. Bids could be placed by addressing the item topic\\ndirectly, e.g. \",[\"$\",\"code\",null,{\"children\":\"auctions/1234/bid\"}],\", but would have to be verified by using a\\nbackend worker as described in the \",[\"$\",\"a\",null,{\"href\":\"#data-validation\",\"children\":\"data validation chapter\"}],\"\\nto make sure that the bid is higher than the current highest bid. Successful\\nbids would be published on the original auction topic as a retained message, so\\nthat all clients that are interested in the item would get the newest bid\\nimmediately.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"further-reading\",\"children\":\"Further Reading\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html\",\"children\":\"MQTT 3.1.1 Specification\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://mosquitto.org/man/mosquitto-conf-5.html\",\"children\":\"Mosquitto Configuration Options\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.hivemq.com/blog/mqtt-essentials-part-4-mqtt-publish-subscribe-unsubscribe/\",\"children\":\"HiveMQ MQTT Essentials Blog Series\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.emqx.com/en/blog/category/mqtt-protocol\",\"children\":\"emqx MQTT Tutorial Series\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you are interested in MQTT, you'll quickly encounter MQTT5. This article uses\\nMQTT 3.1.1 features only, as the changes in MQTT5 are not relevant for the use\\ncases described here. If you want to learn more about MQTT5 and you already have\\na firm grasp of what MQTT 3.1.1 can do, I recommend the\\n\",[\"$\",\"a\",null,{\"href\":\"https://www.hivemq.com/mqtt/mqtt-5/\",\"children\":\"HiveMQ MQTT5 writeup\"}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"about-the-header-image\",\"children\":\"About the header Image\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Created with OpenAIs GPT-4o on 2024-11-15. Prompt:\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"Create an image of a cellular tower in a happy mood. Use a comic style. Do not\\nshow the faces of people.\"}],\"\\n\"]}]]\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"section\",null,{\"className\":\"w-full py-12 md:py-24 lg:py-32 bg-gray-100 dark:bg-gray-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"container px-4 md:px-6 mx-auto\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-3xl font-bold tracking-tighter sm:text-5xl text-center mb-4 md:mb-6\",\"children\":\"More posts like this one\"}],[\"$\",\"div\",null,{\"className\":\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\",\"children\":[[\"$\",\"div\",\"nixos-as-a-freelancer\",{\"ref\":\"$undefined\",\"className\":\"rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between\",\"children\":[[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"flex flex-col space-y-1.5 p-6\",\"children\":[[\"$\",\"h3\",null,{\"ref\":\"$undefined\",\"className\":\"font-semibold leading-none tracking-tight\",\"children\":\"As a freelancer, I put my trust in NixOS. Here's why.\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-1 text-sm text-gray-500\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-11-07T10:11:08.169Z\",\"children\":\"Nov 7, 2024, 11:11 AM\"}]]}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-0\",\"children\":[\"$\",\"p\",null,{\"children\":\"In today's blog I want to talk about why I have chosen NixOS as my main operating system.\"}]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"items-center p-6 pt-0 flex justify-between\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500\",\"children\":[\"By \",\"Sebastian Staffa\"]}],[\"$\",\"$L4\",null,{\"href\":\"/posts/nixos-as-a-freelancer\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2\",\"ref\":\"$undefined\",\"children\":[\"Read More\",[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-right ml-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"mthhwq\",{\"d\":\"m9 18 6-6-6-6\"}],\"$undefined\"]}]]}]}]]}]]}],[\"$\",\"div\",\"on-how-to-lead-devs\",{\"ref\":\"$undefined\",\"className\":\"rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between\",\"children\":[[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"flex flex-col space-y-1.5 p-6\",\"children\":[[\"$\",\"h3\",null,{\"ref\":\"$undefined\",\"className\":\"font-semibold leading-none tracking-tight\",\"children\":\"On How To Lead Devs\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-1 text-sm text-gray-500\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-03-25T15:58:07.801Z\",\"children\":\"Mar 25, 2024, 4:58 PM\"}]]}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-0\",\"children\":[\"$\",\"p\",null,{\"children\":\"After I have been entrusted with leadership responsibilities, it's time to reflect on how not to mess it up.\"}]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"items-center p-6 pt-0 flex justify-between\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500\",\"children\":[\"By \",\"Sebastian Staffa\"]}],[\"$\",\"$L4\",null,{\"href\":\"/posts/on-how-to-lead-devs\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2\",\"ref\":\"$undefined\",\"children\":[\"Read More\",[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-right ml-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"mthhwq\",{\"d\":\"m9 18 6-6-6-6\"}],\"$undefined\"]}]]}]}]]}]]}],[\"$\",\"div\",\"azure-revisited\",{\"ref\":\"$undefined\",\"className\":\"rounded-xl border bg-card text-card-foreground shadow flex flex-col justify-between\",\"children\":[[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"flex flex-col space-y-1.5 p-6\",\"children\":[[\"$\",\"h3\",null,{\"ref\":\"$undefined\",\"className\":\"font-semibold leading-none tracking-tight\",\"children\":\"Azure revisited\"}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-1 text-sm text-gray-500\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2022-11-21T12:13:08.801Z\",\"children\":\"Nov 21, 2022, 1:13 PM\"}]]}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-0\",\"children\":[\"$\",\"p\",null,{\"children\":\"A year with Azure has passed, and this is what I have learned.\"}]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"items-center p-6 pt-0 flex justify-between\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-sm text-gray-500\",\"children\":[\"By \",\"Sebastian Staffa\"]}],[\"$\",\"$L4\",null,{\"href\":\"/posts/azure-revisited\",\"children\":[\"$\",\"button\",null,{\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg]:size-4 [\u0026_svg]:shrink-0 text-primary underline-offset-4 hover:underline h-9 px-4 py-2\",\"ref\":\"$undefined\",\"children\":[\"Read More\",[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-right ml-2 h-4 w-4\",\"children\":[[\"$\",\"path\",\"mthhwq\",{\"d\":\"m9 18 6-6-6-6\"}],\"$undefined\"]}]]}]}]]}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"MQTT For Web Developers\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"MQTT is a protocol that is typically used in an IoT context. In this article, we'll explore how we could use its capabilities in a traditional web application to stream messages in real-time.\"}]]\n"])</script><script>self.__next_f.push([1,"a:null\n"])</script></body></html>